<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>wjt&#39;s Blog</title>
  
  <subtitle>一个菜鸟的blog</subtitle>
  <link href="https://my.wjtblog.online/atom.xml" rel="self"/>
  
  <link href="https://my.wjtblog.online/"/>
  <updated>2023-02-16T01:37:16.805Z</updated>
  <id>https://my.wjtblog.online/</id>
  
  <author>
    <name>wjt</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>快手滑动验证码</title>
    <link href="https://my.wjtblog.online/undefined/a4a76f26.html"/>
    <id>https://my.wjtblog.online/undefined/a4a76f26.html</id>
    <published>2022-10-13T06:26:00.000Z</published>
    <updated>2023-02-16T01:37:16.805Z</updated>
    
    <content type="html"><![CDATA[<span class='p center logo large'>快手滑动验证码</span><h2 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h2><p>快手滑动验证码更新之后新增了KsecrectApiVerify这个接口验证，验证正确之后页面会进行刷新<br><div class="img-wrap"><div class="img-bg"><img class="img" src="/img/kuaishou/KsecrectApiVerify.png"/></div></div></p><p>network清空请求后进行验证<br><div class="img-wrap"><div class="img-bg"><img class="img" src="/img/kuaishou/network.png"/></div></div></p><p>发现会出现两种结果<br>失败：<br><div class="img-wrap"><div class="img-bg"><img class="img" src="/img/kuaishou/fail.png"/></div></div></p><p>成功：<br><div class="img-wrap"><div class="img-bg"><img class="img" src="/img/kuaishou/success.png"/></div></div></p><h2 id="参数分析"><a href="#参数分析" class="headerlink" title="参数分析"></a>参数分析</h2><p>查看一下post参数 JSON格式的加密参数<br><div class="img-wrap"><div class="img-bg"><img class="img" src="/img/kuaishou/params.png"/></div></div></p><p>verifyParam这个命名一看就是某个参数进行加密的 看看堆栈是啥样的<br><div class="img-wrap"><div class="img-bg"><img class="img" src="/img/kuaishou/duizhan.png"/></div></div></p><p>经过缓慢的调试最后定位到这个方法中<br><div class="img-wrap"><div class="img-bg"><img class="img" src="/img/kuaishou/dingwei.png"/></div></div></p><p>控制台打印一下方法<br><div class="img-wrap"><div class="img-bg"><img class="img" src="/img/kuaishou/fangfa.png"/></div></div><br>发现与最后请求的参数一致 这个方法就是生成加密的方法</p><p>分析一下这里面具体都是什么参数<br><div class="img-wrap"><div class="img-bg"><img class="img" src="/img/kuaishou/canshu1.png"/></div></div><br><div class="img-wrap"><div class="img-bg"><img class="img" src="/img/kuaishou/canshu2.png"/></div></div>v</p><p>这个r参数里面就代表着验证码的各种信息 包括验证码id 验证码以及滑块的长宽高 以及最重要的trajectory即滑动轨迹等等<br>接着往下看方法<br><div class="img-wrap"><div class="img-bg"><img class="img" src="/img/kuaishou/canshu3.png"/></div></div><br>拼接字符串获得a<br><div class="img-wrap"><div class="img-bg"><img class="img" src="/img/kuaishou/canshu4.png"/></div></div><br>再通过a生成数组<br>最后再通过这个数组经过Promise函数放进去一个DES加密生成最后的参数<br><div class="img-wrap"><div class="img-bg"><img class="img" src="/img/kuaishou/promise.png"/></div></div></p><p>流程到这里就走通了</p><h2 id="参数还原"><a href="#参数还原" class="headerlink" title="参数还原"></a>参数还原</h2><p>首先是r中包含的验证码信息</p><p>经过network搜索可以看到发送的验证码请求<br><div class="img-wrap"><div class="img-bg"><img class="img" src="/img/kuaishou/yanzhengma.png"/></div></div><br>这个就很清楚了，这个请求返回了验证码的各种信息，包括图片地址和滑块地址<br>经多次测试r中的bgPicHeight、bgPicWidth、cutPicWidth、cutPicHeight参数代表着验证码的大小信息且不变，disY指的是滑块的高度但是其实根据返回的信息进行切割比缩放也可以得到值（切割比缩放: bgPicWidth/原bgPicWidth*disY）<br>另captchaExtraParam为浏览器信息、gpuInfo为设备信息<br>这些都可为定值<br>我们重点关注captchaSn、relativeX、trajectory这三个参数<br>captchaSn：此二维码的唯一标识,图片验证码url中有带这个参数<br>relativeX ：滑动的距离，图片识别之后也进行缩放即可<br>trajectory :滑动轨迹（X坐标|Y坐标|时间（由0开始））这个平滑的不行，X跟Y都得是有抖动才能通过验证</p><p>其中最麻烦的就是trajectory滑动轨迹<br>需要有人工抖动才能通过，即使是人手有时候也会有错误返回<br>为了节省时间，作者将所有可能的验证码识别出来的距离都进行了记录，下一次识别出来的时候直接调用就好了 有兴趣的可以试试用算法写出来</p><p>Promise函数生成<br><div class="img-wrap"><div class="img-bg"><img class="img" src="/img/kuaishou/hanshu.png"/></div></div><br>直接上代码</p><pre><code>function get_sign(a) &#123;        var utf8arry = new TextEncoder().encode(a);        window.Jose.realm.global.$encrypt(utf8arry, &quot;c7b645db-65e8-401f-b38c-4c07c5fff247&quot;, &#123;            &quot;err&quot;: function() &#123;                debugger            &#125;,            &quot;suc&quot;: function(arg) &#123;                window.result = arg;                console.log(&quot;这是结果&quot;, arg);                return arg            &#125;        &#125;);        return window.result    &#125;</code></pre><p>剩下就是补环境调用了 就不过多赘述了</p>]]></content>
    
    
    <summary type="html">验证码很烦人呢 想想办法</summary>
    
    
    
    <category term="逆向" scheme="https://my.wjtblog.online/categories/%E9%80%86%E5%90%91/"/>
    
    
    <category term="技术" scheme="https://my.wjtblog.online/tags/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="逆向" scheme="https://my.wjtblog.online/tags/%E9%80%86%E5%90%91/"/>
    
  </entry>
  
  <entry>
    <title>加密参数的定位方式</title>
    <link href="https://my.wjtblog.online/undefined/f1126df1.html"/>
    <id>https://my.wjtblog.online/undefined/f1126df1.html</id>
    <published>2022-09-16T06:27:00.000Z</published>
    <updated>2022-09-16T08:02:30.643Z</updated>
    
    <content type="html"><![CDATA[<span class='p center logo large'>加密参数的定位方式</span><p>上篇文章中我们知道了常见的几种加密方式，但是如何找到这些加密都是在哪生成的呢，这篇文章就来谈谈最常见的几种定位加密文件的方法</p><h2 id="谷歌浏览器搜索"><a href="#谷歌浏览器搜索" class="headerlink" title="谷歌浏览器搜索"></a>谷歌浏览器搜索</h2><p>以某短视频平台为例<br>我们F12打开开发者工具 选择network 刷新一下页面<br>然后ctrl + f打开搜索框全局搜索我们的加密字符串 如签名signature等<br><div class="img-wrap"><div class="img-bg"><img class="img" src="/img/dingwei/search.jpg"/></div></div></p><p>要是搜索不到可以搜索接口名如<br>/general/search 这种接口名称</p><h2 id="堆栈调试"><a href="#堆栈调试" class="headerlink" title="堆栈调试"></a>堆栈调试</h2><p>谷歌浏览器控制台中的Initiator是很好用的一个功能<br>我们打开一个js文件然后打上断电进行刷新<br><div class="img-wrap"><div class="img-bg"><img class="img" src="/img/dingwei/breakpoint.jpg"/></div></div><br>可以看到在进行到我们的断点位置之后停下来了<br>我们看到右侧的堆栈情况可以通过调用顺序来确定加密位置的生成<br><div class="img-wrap"><div class="img-bg"><img class="img" src="/img/dingwei/dui.jpg"/></div></div></p><h2 id="控制台输出"><a href="#控制台输出" class="headerlink" title="控制台输出"></a>控制台输出</h2><p>在控制台中我们可以输入变量名、函数名等等<br>控制台输出当前的信息帮助我们更好地进行分析<br>谷歌浏览器中直接输入值即可 即xxx == console.log(xxx)<br><div class="img-wrap"><div class="img-bg"><img class="img" src="/img/dingwei/log.jpg"/></div></div></p><h2 id="监听xhr"><a href="#监听xhr" class="headerlink" title="监听xhr"></a>监听xhr</h2><p>xhr是XMLHttpRequest的简称，通过监听XHR的断点可以匹配URL中的params参数的触发点和调用堆栈<br>对于get请求来说，当url中的参数生成时就能够在第一时间停下来，并通过堆栈进行分析<br>而对于post请求来说，其中的From Data的参数也可以用XHR来拦截<br><div class="img-wrap"><div class="img-bg"><img class="img" src="/img/dingwei/xhr.jpg"/></div></div></p><h2 id="事件监听"><a href="#事件监听" class="headerlink" title="事件监听"></a>事件监听</h2><p>事件监听的位置就在XHR的下面，可以近似的理解为当触发下列事件之后进行断点操作<br><div class="img-wrap"><div class="img-bg"><img class="img" src="/img/dingwei/event.jpg"/></div></div></p><h2 id="jsHook"><a href="#jsHook" class="headerlink" title="jsHook"></a>jsHook</h2><p>当我们遇到一些cookie验证，我们需要知道他是怎么生成的时候<br>js hook是比较理想的选择<br>我们可以直接hook document.cookie的set方法进行快速查找<br>首先先打开谷歌浏览器的代码片<br><div class="img-wrap"><div class="img-bg"><img class="img" src="/img/dingwei/hook.jpg"/></div></div><br>按照如上操作进行添加代码段操作</p><p>常见一些hook 代码也贴出来</p><p>Hook setInterval</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">let</span> _setInterval=<span class="built_in">setInterval</span>;</span><br><span class="line">        <span class="built_in">setInterval</span>=<span class="keyword">function</span>(<span class="params">a,b</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(a.<span class="title function_">toString</span>().<span class="title function_">indexOf</span>(<span class="string">&quot;debugger&quot;</span>)!=-<span class="number">1</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="title function_">_setInterval</span>(a,b);</span><br><span class="line">&#125;        </span><br></pre></td></tr></table></figure><p>Hook header</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> header_old = <span class="variable language_">window</span>.<span class="property">XMLHttpRequest</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">setRequestHeader</span>;</span><br><span class="line"><span class="variable language_">window</span>.<span class="property">XMLHttpRequest</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">setRequestHeader</span> = <span class="keyword">function</span> (<span class="params">key, value</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (key==<span class="string">&#x27;k&#x27;</span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(key, value)</span><br><span class="line">        <span class="keyword">debugger</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (key==<span class="string">&#x27;token&#x27;</span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(key, value)</span><br><span class="line">        <span class="keyword">debugger</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> header_old.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Hook Cookie Info</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> cookie_cache = <span class="variable language_">document</span>.<span class="property">cookie</span>;</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(<span class="variable language_">document</span>, <span class="string">&#x27;cookie&#x27;</span>, &#123;</span><br><span class="line">        <span class="attr">get</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Getting cookie&#x27;</span>);</span><br><span class="line">            <span class="keyword">return</span> cookie_cache;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">set</span>: <span class="keyword">function</span>(<span class="params">val</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Setting cookie&#x27;</span>, val);</span><br><span class="line">            <span class="keyword">var</span> cookie = val.<span class="title function_">split</span>(<span class="string">&quot;;&quot;</span>)[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">var</span> ncookie = cookie.<span class="title function_">split</span>(<span class="string">&quot;=&quot;</span>);</span><br><span class="line">            <span class="keyword">var</span> flag = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">var</span> cache = cookie_cache.<span class="title function_">split</span>(<span class="string">&quot;; &quot;</span>);</span><br><span class="line">            cache = cache.<span class="title function_">map</span>(<span class="keyword">function</span>(<span class="params">a</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span> (a.<span class="title function_">split</span>(<span class="string">&quot;=&quot;</span>)[<span class="number">0</span>] === ncookie[<span class="number">0</span>])&#123;</span><br><span class="line">                    flag = <span class="literal">true</span>;</span><br><span class="line">                    <span class="keyword">return</span> cookie;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> a;</span><br><span class="line">            &#125;)</span><br><span class="line">            cookie_cache = cache.<span class="title function_">join</span>(<span class="string">&quot;; &quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (!flag)&#123;</span><br><span class="line">                cookie_cache += cookie + <span class="string">&quot;; &quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">_value</span> = val;</span><br><span class="line">            <span class="keyword">return</span> cookie_cache;</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure><p>Hook Json Info</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> my_stringify = <span class="title class_">JSON</span>.<span class="property">stringify</span>;</span><br><span class="line">    <span class="title class_">JSON</span>.<span class="property">stringify</span> = <span class="keyword">function</span> (<span class="params">params</span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;json_stringify:&quot;</span>, params);</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">json_stringify</span>(params);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> my_parse = <span class="title class_">JSON</span>.<span class="property">parse</span>;</span><br><span class="line">    <span class="title class_">JSON</span>.<span class="property">parse</span> = <span class="keyword">function</span> (<span class="params">params</span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;json_parse:&quot;</span>, params);</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">json_parse</span>(params);</span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure><p>Hook WebSocket Info</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">WebSocket</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">senda</span> = <span class="title class_">WebSocket</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">send</span>;</span><br><span class="line">    <span class="title class_">WebSocket</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">send</span> = <span class="keyword">function</span> (<span class="params">data</span>)&#123;</span><br><span class="line">     <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&quot;Hook WebSocket&quot;</span>, data);</span><br><span class="line">     <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">senda</span>(data)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>Hook Cookie</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line">    <span class="keyword">var</span> cookie_cache = <span class="variable language_">document</span>.<span class="property">cookie</span>;</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(<span class="variable language_">document</span>, <span class="string">&#x27;cookie&#x27;</span>, &#123;</span><br><span class="line">        <span class="attr">get</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="comment">// console.log(cookie_cache);</span></span><br><span class="line">            <span class="keyword">return</span> cookie_cache;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">set</span>: <span class="keyword">function</span>(<span class="params">val</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (val.<span class="title function_">indexOf</span>(<span class="string">&#x27;gdxidpyhxdE&#x27;</span>) != -<span class="number">1</span>)&#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;cookie&#x27;</span>,val)   </span><br><span class="line">                <span class="keyword">debugger</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">var</span> cookie = val.<span class="title function_">split</span>(<span class="string">&quot;;&quot;</span>)[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">var</span> ncookie = cookie.<span class="title function_">split</span>(<span class="string">&quot;=&quot;</span>);</span><br><span class="line">            <span class="keyword">var</span> flag = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">var</span> cache = cookie_cache.<span class="title function_">split</span>(<span class="string">&quot;;&quot;</span>);</span><br><span class="line">            cache = cache.<span class="title function_">map</span>(<span class="keyword">function</span>(<span class="params">a</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span> (a.<span class="title function_">split</span>(<span class="string">&quot;=&quot;</span>)[<span class="number">0</span>] === ncookie[<span class="number">0</span>])&#123;</span><br><span class="line">                    flag = <span class="literal">true</span>;</span><br><span class="line">                    <span class="keyword">return</span> cookie;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> a;</span><br><span class="line">            &#125;)</span><br><span class="line">            cookie_cache = cache.<span class="title function_">join</span>(<span class="string">&quot;;&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (!flag)&#123;</span><br><span class="line">                cookie_cache += cookie + <span class="string">&quot;;&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><p>Hook XHR</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">// 代码作者：掘金tager</span></span><br><span class="line"><span class="comment">// xhr中的方法拦截，eg: open、send etc.</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">hookFunction</span>(<span class="params">funcName, config</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> args = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">slice</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>)</span><br><span class="line">    <span class="comment">// 将open参数存入xhr, 在其它事件回调中可以获取到。</span></span><br><span class="line">    <span class="keyword">if</span> (funcName === <span class="string">&#x27;open&#x27;</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">xhr</span>.<span class="property">open_args</span> = args</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (config[funcName]) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>, <span class="string">&#x27;this&#x27;</span>)</span><br><span class="line">      <span class="comment">// 配置的函数执行结果返回为true时终止调用</span></span><br><span class="line">      <span class="keyword">var</span> result = config[funcName].<span class="title function_">call</span>(<span class="variable language_">this</span>, args, <span class="variable language_">this</span>.<span class="property">xhr</span>)</span><br><span class="line">      <span class="keyword">if</span> (result) <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">xhr</span>[funcName].<span class="title function_">apply</span>(<span class="variable language_">this</span>.<span class="property">xhr</span>, <span class="variable language_">arguments</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// xhr中的属性和事件的拦截</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getterFactory</span>(<span class="params">attr, config</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> value = <span class="variable language_">this</span>.<span class="title function_">hasOwnProperty</span>(attr + <span class="string">&quot;_&quot;</span>) ? <span class="variable language_">this</span>[attr + <span class="string">&quot;_&quot;</span>] : <span class="variable language_">this</span>.<span class="property">xhr</span>[attr];</span><br><span class="line">    <span class="keyword">var</span> getterHook = (config[attr] || &#123;&#125;)[<span class="string">&quot;getter&quot;</span>]</span><br><span class="line">    <span class="keyword">return</span> getterHook &amp;&amp; <span class="title function_">getterHook</span>(value, <span class="variable language_">this</span>) || value</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 在赋值时触发该工厂函数（如onload等事件）</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">setterFactory</span>(<span class="params">attr, config</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> _this = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">var</span> xhr = <span class="variable language_">this</span>.<span class="property">xhr</span>;</span><br><span class="line">    <span class="keyword">var</span> hook = config[attr]; <span class="comment">// 方法或对象</span></span><br><span class="line">    <span class="variable language_">this</span>[attr + <span class="string">&quot;_&quot;</span>] = value;</span><br><span class="line">    <span class="keyword">if</span> (<span class="regexp">/^on/</span>.<span class="title function_">test</span>(attr)) &#123;</span><br><span class="line">      <span class="comment">// note：间接的在真实的xhr上给事件绑定函数</span></span><br><span class="line">      xhr[attr] = <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">        <span class="comment">// e = configEvent(e, _this)</span></span><br><span class="line">        <span class="keyword">var</span> result = hook &amp;&amp; config[attr].<span class="title function_">call</span>(_this, xhr, e)</span><br><span class="line">        result || value.<span class="title function_">call</span>(_this, e);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">var</span> attrSetterHook = (hook || &#123;&#125;)[<span class="string">&quot;setter&quot;</span>]</span><br><span class="line">      value = attrSetterHook &amp;&amp; <span class="title function_">attrSetterHook</span>(value, _this) || value</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 并非xhr的所有属性都是可写的</span></span><br><span class="line">        xhr[attr] = value;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">warn</span>(<span class="string">&#x27;xhr的&#x27;</span> + attr + <span class="string">&#x27;属性不可写&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 核心拦截的handler</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">xhrHook</span>(<span class="params">config</span>) &#123;</span><br><span class="line">  <span class="comment">// 存储真实的xhr构造器, 在取消hook时，可恢复</span></span><br><span class="line">  <span class="variable language_">window</span>.<span class="property">realXhr</span> = <span class="variable language_">window</span>.<span class="property">realXhr</span> || <span class="title class_">XMLHttpRequest</span></span><br><span class="line">  <span class="comment">// 重写XMLHttpRequest构造函数</span></span><br><span class="line">  <span class="title class_">XMLHttpRequest</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> xhr = <span class="keyword">new</span> <span class="variable language_">window</span>.<span class="title function_">realXhr</span>()</span><br><span class="line">    <span class="comment">// 真实的xhr实例存储到自定义的xhr属性中</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">xhr</span> = xhr</span><br><span class="line">    <span class="comment">// note: 遍历实例及其原型上的属性（实例和原型链上有相同属性时，取实例属性）</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> attr <span class="keyword">in</span> xhr) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(xhr[attr]) === <span class="string">&#x27;[object Function]&#x27;</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>[attr] = <span class="title function_">hookFunction</span>(attr, config); <span class="comment">// 接管xhr function</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// attention: 如果重写XMLHttpRequest，必须要全部重写，否则在ajax中不会触发success、error（原因是3.x版本是在load事件中执行success）</span></span><br><span class="line">        <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(<span class="variable language_">this</span>, attr, &#123; <span class="comment">// 接管xhr attr、event</span></span><br><span class="line">          <span class="attr">get</span>: <span class="title function_">getterFactory</span>(attr, config),</span><br><span class="line">          <span class="attr">set</span>: <span class="title function_">setterFactory</span>(attr, config),</span><br><span class="line">          <span class="attr">enumerable</span>: <span class="literal">true</span></span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">window</span>.<span class="property">realXhr</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解除xhr拦截，归还xhr管理权</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">unXhrHook</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">window</span>[realXhr]) <span class="title class_">XMLHttpRequest</span> = <span class="variable language_">window</span>[realXhr];</span><br><span class="line">  <span class="variable language_">window</span>[realXhr] = <span class="literal">undefined</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 执行部分</span></span><br><span class="line"><span class="title function_">xhrHook</span>(&#123;</span><br><span class="line">  <span class="attr">open</span>: <span class="keyword">function</span> (<span class="params">args, xhr</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;open called!&quot;</span>, args, xhr)</span><br><span class="line">     <span class="comment">// return true // 返回true将终止请求，这个就是常规拦截的精髓了</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">setRequestHeader</span>: <span class="keyword">function</span> (<span class="params">args, xhr</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;setRequestHeader called!&quot;</span>, args, xhr)</span><br><span class="line">         &#125;,</span><br><span class="line">  <span class="attr">onload</span>: <span class="keyword">function</span> (<span class="params">xhr</span>) &#123;</span><br><span class="line">    <span class="comment">// 对响应结果做处理</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">responseText</span> += <span class="string">&#x27; tager&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="内存漫游"><a href="#内存漫游" class="headerlink" title="内存漫游"></a>内存漫游</h2><p>内存漫游的方案来源于ast-hook-js-RE<br>是基于AST和Hook构建的内存漫游工具<br>与hook最明显不同的是，hook根据变量名key来搜索 但内存漫游通过变量value来进行搜索<br>Github地址 <a href="https://github.com/CC11001100/ast-hook-for-js-RE">ast-hook-js-RE</a><br>实现方法：通过设置AnyProxy代理服务器拦截响应，并通过AST实时处理，让所有涉及变量改动的地方都经过Hook方法，这样所有变量值的改动都可以捕获并保存到一个变量数据库中。接下来就能根据变量值搜索到存储这个字符串的变量及变量所在的代码位置 hook.search(‘’)<br><div class="img-wrap"><div class="img-bg"><img class="img" src="/img/dingwei/asthook.jpg"/></div></div></p>]]></content>
    
    
    <summary type="html">你猜猜他都是在哪里加密的呀</summary>
    
    
    
    <category term="知识点补充" scheme="https://my.wjtblog.online/categories/%E7%9F%A5%E8%AF%86%E7%82%B9%E8%A1%A5%E5%85%85/"/>
    
    
    <category term="技术" scheme="https://my.wjtblog.online/tags/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="逆向" scheme="https://my.wjtblog.online/tags/%E9%80%86%E5%90%91/"/>
    
    <category term="知识点补充" scheme="https://my.wjtblog.online/tags/%E7%9F%A5%E8%AF%86%E7%82%B9%E8%A1%A5%E5%85%85/"/>
    
  </entry>
  
  <entry>
    <title>常见的编码和加密方式</title>
    <link href="https://my.wjtblog.online/undefined/32d76036.html"/>
    <id>https://my.wjtblog.online/undefined/32d76036.html</id>
    <published>2022-09-15T08:16:00.000Z</published>
    <updated>2022-09-15T12:56:05.573Z</updated>
    
    <content type="html"><![CDATA[<span class='p center logo large'>常见的编码和加密方式</span><h2 id="加密解密-编码解码"><a href="#加密解密-编码解码" class="headerlink" title="加密解密 编码解码"></a>加密解密 编码解码</h2><p>在我们逆向的过程中时常会看到加密的参数等，我们要做的就是解密的过程，那么了解加密的过程就成了必修课<br>常见的编码有base64、unicode、urlencode<br>常见的加密有MD5、SHA1、HMAC、AES、DES、RSA等<br>本文会给出相应的js及python代码方便大家的使用</p><h2 id="base64"><a href="#base64" class="headerlink" title="base64"></a>base64</h2><p>Base64是网络上最常见的用于传输8Bit字节码的编码方式之一，Base64就是一种基于64个可打印字符来表示二进制数据的方法。<br>在base64编码过程中能起到一定的加密作用，在逆向的过程中时常会遇到<br>在浏览器中提供了原生的编解码函数分别为 btoa和atob<br><div class="img-wrap"><div class="img-bg"><img class="img" src="/img/jiami/base64.jpg"/></div></div><br>在js中<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str1 = <span class="string">&quot;wjt&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> str2 = <span class="string">&#x27;d2p0&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> str2Base64 = <span class="keyword">new</span> <span class="title class_">Buffer</span>(str1).<span class="title function_">toString</span>(<span class="string">&#x27;base64&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> base642Str = <span class="keyword">new</span> <span class="title class_">Buffer</span>(str2,<span class="string">&#x27;base64&#x27;</span>).<span class="title function_">toString</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(str2Base64)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(base642Str)</span><br></pre></td></tr></table></figure></p><p>在python中<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="built_in">print</span>(base64.b64encode(<span class="string">&quot;wjt&quot;</span>.encode()))</span><br><span class="line"><span class="built_in">print</span>(base64.b64decode(<span class="string">&quot;d2p0&quot;</span>.encode()))</span><br></pre></td></tr></table></figure></p><h2 id="MD5"><a href="#MD5" class="headerlink" title="MD5"></a>MD5</h2><p>一种被广泛使用的密码散列函数，可以产生出一个128位（16字节）的散列值（hash value），用于确保信息传输完整一致。<br>MD5算法不可逆，但是特征也比较明显<br>在出现32位字符时可以尝试直接加密看看<br>在js中可通过crypto-js加密库来实现<br>安装:npm install crypto-js<br>在js中<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">CryptoJS</span> = <span class="built_in">require</span>(<span class="string">&#x27;crypto-js&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> password = <span class="string">&quot;wjt123&quot;</span></span><br><span class="line"><span class="keyword">let</span> encPwd = <span class="title class_">CryptoJS</span>.<span class="title class_">MD5</span>(password).<span class="title function_">toString</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(encPwd)</span><br></pre></td></tr></table></figure></p><p>在python中<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">m = hashlib.md5()</span><br><span class="line">m.update(<span class="string">b&#x27;wjt123&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(m.hexdigest())</span><br></pre></td></tr></table></figure></p><h2 id="SHA1"><a href="#SHA1" class="headerlink" title="SHA1"></a>SHA1</h2><p>SHA-1可以生成一个被称为消息摘要的160位（20字节）散列值，散列值通常的呈现形式为40个十六进制数。<br>一般在未高强度混淆的js代码中，关键词就是sha1<br>在js中<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">CryptoJS</span> = <span class="built_in">require</span>(<span class="string">&#x27;crypto-js&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> password = <span class="string">&quot;wjt123&quot;</span></span><br><span class="line"><span class="keyword">let</span> encPwd = <span class="title class_">CryptoJS</span>.<span class="title class_">SHA1</span>(password).<span class="title function_">toString</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(encPwd)</span><br></pre></td></tr></table></figure></p><p>在python中<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">sha1 = hashlib.sha1()</span><br><span class="line">password = <span class="string">&quot;wjt123&quot;</span></span><br><span class="line">sha1.update(password.encode(<span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line"><span class="built_in">print</span>(sha1.hexdigest())</span><br></pre></td></tr></table></figure></p><h2 id="HMAC"><a href="#HMAC" class="headerlink" title="HMAC"></a>HMAC</h2><p>HMAC全称为：散列消息鉴别码。是一种安全的基于加密hash函数和共享密钥的消息认证协议。实现原理时用公开函数和密钥产生一个固定长度的值作为认证标识，用这个标识鉴别消息的完整性<br>在js中<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">CryptoJS</span> = <span class="built_in">require</span>(<span class="string">&#x27;crypto-js&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> password = <span class="string">&quot;wjt123&quot;</span></span><br><span class="line"><span class="keyword">let</span> key = <span class="string">&quot;key&quot;</span></span><br><span class="line"><span class="keyword">let</span> hash = <span class="title class_">CryptoJS</span>.<span class="title class_">HmacSHA256</span>(password,key)</span><br><span class="line"><span class="keyword">let</span> hashInHex = <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Hex</span>.<span class="title function_">stringify</span>(hash)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(hashInHex)</span><br></pre></td></tr></table></figure></p><p>在python中<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hmac</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">key = <span class="string">&#x27;key&#x27;</span>.encode()</span><br><span class="line">password = <span class="string">&quot;wjt123&quot;</span>.encode()</span><br><span class="line">mac = hmac.new(key,password,hashlib.sha256)</span><br><span class="line">mac.digest()</span><br><span class="line"><span class="built_in">print</span>(mac.hexdigest())</span><br></pre></td></tr></table></figure></p><h2 id="DES"><a href="#DES" class="headerlink" title="DES"></a>DES</h2><p>DES全称为Data Encryption Standard，即数据加密标准，是一种使用密钥加密的块算法<br>DES算法的入口参数有三个：Key、Data、Mode。其中Key为7个字节共56位，是DES算法的工作密钥；Data为8个字节64位，是要被加密或被解密的数据；Mode为DES的工作方式,有两种:加密或解密。<br>DES的加密搜索关键词有DES、mode、padding<br>在js中<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">CryptoJS</span> = <span class="built_in">require</span>(<span class="string">&#x27;crypto-js&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> password = <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>.<span class="title function_">parse</span>(<span class="string">&quot;123456&quot;</span>)</span><br><span class="line"><span class="keyword">let</span> key = <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>.<span class="title function_">parse</span>(<span class="string">&quot;1234567&quot;</span>)</span><br><span class="line">cfg = &#123;</span><br><span class="line">    <span class="attr">mode</span>:<span class="title class_">CryptoJS</span>.<span class="property">mode</span>.<span class="property">ECB</span>,</span><br><span class="line">    padding : <span class="title class_">CryptoJS</span>.<span class="property">pad</span>.<span class="property">Pkcs7</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> encPwd = <span class="title class_">CryptoJS</span>.<span class="property">DES</span>.<span class="title function_">encrypt</span>(password,key,cfg).<span class="title function_">toString</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(encPwd)</span><br><span class="line">decPwd = <span class="title class_">CryptoJS</span>.<span class="property">DES</span>.<span class="title function_">decrypt</span>(encPwd,key,cfg).<span class="title function_">toString</span>(<span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(decPwd)</span><br></pre></td></tr></table></figure></p><p>在python中<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">from</span> pyDes <span class="keyword">import</span> des,CBC,PAD_PKCS5</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">des_encrypt</span>(<span class="params">secret_key,s</span>):</span><br><span class="line">    iv = secret_key</span><br><span class="line">    k =des(secret_key,CBC,iv,pad=<span class="literal">None</span>,padmode=PAD_PKCS5)</span><br><span class="line">    en = k.encrypt(s,padmode=PAD_PKCS5)</span><br><span class="line">    <span class="keyword">return</span> binascii.b2a_hex(en)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">des_decrypt</span>(<span class="params">secret_key,s</span>):</span><br><span class="line">    iv = secret_key</span><br><span class="line">    k = des(secret_key,CBC,iv,pad=<span class="literal">None</span>,padmode=PAD_PKCS5)</span><br><span class="line">    de = k.decrypt(binascii.a2b_hex(s),padmode=PAD_PKCS5)</span><br><span class="line">    <span class="keyword">return</span> de</span><br><span class="line"></span><br><span class="line">secret_str = des_encrypt(<span class="string">&quot;12345678&quot;</span>,<span class="string">&quot;wjt123&quot;</span>)</span><br><span class="line">clear_str = des_decrypt(<span class="string">&quot;12345678&quot;</span>,secret_str)</span><br><span class="line"><span class="built_in">print</span>(secret_str)</span><br><span class="line"><span class="built_in">print</span>(clear_str)</span><br></pre></td></tr></table></figure></p><h2 id="AES"><a href="#AES" class="headerlink" title="AES"></a>AES</h2><p>AES为堆成加密算法，如果能获取到密钥，那么就能对密文进行解密<br>AES填充模式有三种 NoPadding、ZeroPadding、Pkcs7，默认为Pkcs7<br>搜索关键词有AES、mode、padding<br>在js中<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">CryptoJs</span> = <span class="built_in">require</span>(<span class="string">&#x27;crypto-js&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> password = <span class="string">&quot;wjt123&quot;</span></span><br><span class="line"><span class="keyword">let</span> key = <span class="string">&quot;1234567890abcdef&quot;</span></span><br><span class="line"><span class="comment">// AES加密</span></span><br><span class="line">cfg = &#123;</span><br><span class="line"><span class="attr">mode</span>: <span class="title class_">CryptoJs</span>.<span class="property">mode</span>.<span class="property">ECB</span>,</span><br><span class="line"><span class="attr">padding</span>: <span class="title class_">CryptoJs</span>.<span class="property">pad</span>.<span class="property">Pkcs7</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> encPwd = <span class="title class_">CryptoJs</span>.<span class="property">AES</span>.<span class="title function_">encrypt</span>(password, key, cfg).<span class="title function_">toString</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(encPwd)</span><br><span class="line"><span class="comment">// AES解密</span></span><br><span class="line"><span class="keyword">let</span> keys = <span class="title class_">CryptoJs</span>.<span class="property">enc</span>.<span class="property">Utf8</span>.<span class="title function_">parse</span>(<span class="string">&quot;1234567890abcdef&quot;</span>)</span><br><span class="line">cfg = &#123;</span><br><span class="line"><span class="attr">mode</span>: <span class="title class_">CryptoJs</span>.<span class="property">mode</span>.<span class="property">ECB</span>,</span><br><span class="line"><span class="attr">padding</span>: <span class="title class_">CryptoJs</span>.<span class="property">pad</span>.<span class="property">Pkcs7</span></span><br><span class="line">&#125;</span><br><span class="line">encPwd = <span class="string">&quot;58x7DuDGdEEtP//h3RpmNw==&quot;</span></span><br><span class="line">decPwd = <span class="title class_">CryptoJs</span>.<span class="property">AES</span>.<span class="title function_">decrypt</span>(encPwd, keys, cfg).<span class="title function_">toString</span>(<span class="title class_">CryptoJs</span>.<span class="property">enc</span>.<span class="property">Utf8</span>) <span class="comment">// 指定解码方式</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(decPwd) </span><br></pre></td></tr></table></figure></p><p>在python中<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="comment"># AES</span></span><br><span class="line"><span class="comment"># 需要补位，str不是16的倍数那就补足为16的倍数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_to_16</span>(<span class="params">value</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(value) % <span class="number">16</span> != <span class="number">0</span>:</span><br><span class="line">        value += <span class="string">&#x27;\0&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>.encode(value)  <span class="comment"># 返回bytes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 加密方法</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">key, text</span>):</span><br><span class="line">    aes = AES.new(add_to_16(key), AES.MODE_ECB)  <span class="comment"># 初始化加密器</span></span><br><span class="line">    encrypt_aes = aes.encrypt(add_to_16(text))  <span class="comment"># 先进行aes加密</span></span><br><span class="line">    encrypted_text = <span class="built_in">str</span>(base64.encodebytes(encrypt_aes), encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> encrypted_text</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解密方法</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">key, text</span>):</span><br><span class="line">    aes = AES.new(add_to_16(key), AES.MODE_ECB)  <span class="comment"># 初始化加密器</span></span><br><span class="line">    base64_decrypted = base64.decodebytes(text.encode(encoding=<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    decrypted_text = <span class="built_in">str</span>(aes.decrypt(base64_decrypted), encoding=<span class="string">&#x27;utf-8&#x27;</span>).replace(<span class="string">&#x27;\0&#x27;</span>, <span class="string">&#x27;&#x27;</span>)  <span class="comment"># 执行解密密并转码返回str</span></span><br><span class="line">    <span class="keyword">return</span> decrypted_text</span><br></pre></td></tr></table></figure></p><p>RSA算法<br>非对称加密算法，是一个能同时用于加密和数字签名的算法<br>主要标志有setPublickey<br>在js中<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">window</span> = <span class="variable language_">global</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">JSEncrypt</span> = <span class="built_in">require</span>(<span class="string">&#x27;jsencrypt&#x27;</span>);</span><br><span class="line">publickey = <span class="string">&#x27;公钥&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加密</span></span><br><span class="line"><span class="keyword">let</span> jse = <span class="keyword">new</span> <span class="title class_">JSEncrypt</span>();</span><br><span class="line">jse.<span class="title function_">setPublicKey</span>(publickey);</span><br><span class="line"><span class="keyword">var</span> encStr = jse.<span class="title function_">encrypt</span>(<span class="string">&#x27;username&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解密</span></span><br><span class="line">privatekey = <span class="string">&#x27;私钥&#x27;</span>;</span><br><span class="line">jse.<span class="title function_">setPrivateKey</span>(privatekey);</span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Str</span> = jse.<span class="title function_">decrypt</span>(encStr);</span><br></pre></td></tr></table></figure></p><p>在python中<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> rsa</span><br><span class="line"><span class="keyword">from</span> rsa <span class="keyword">import</span> common</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RsaUtil</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    PUBLIC_KEY_PATH = <span class="string">&#x27;public_key.pem&#x27;</span>  <span class="comment"># 公钥</span></span><br><span class="line">    PRIVATE_KEY_PATH = <span class="string">&#x27;private_key.pem&#x27;</span>  <span class="comment"># 私钥</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 初始化key</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,</span></span><br><span class="line"><span class="params">                company_pub_file=PUBLIC_KEY_PATH,</span></span><br><span class="line"><span class="params">                company_pri_file=PRIVATE_KEY_PATH</span>):</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> company_pub_file:</span><br><span class="line">            self.company_public_key = rsa.PublicKey.load_pkcs1_openssl_pem(<span class="built_in">open</span>(company_pub_file).read())</span><br><span class="line">        <span class="keyword">if</span> company_pri_file:</span><br><span class="line">            self.company_private_key = rsa.PrivateKey.load_pkcs1(<span class="built_in">open</span>(company_pri_file).read())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_max_length</span>(<span class="params">self, rsa_key, encrypt=<span class="literal">True</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;加密内容过长时 需要分段加密 换算每一段的长度.</span></span><br><span class="line"><span class="string">            :param rsa_key: 钥匙.</span></span><br><span class="line"><span class="string">            :param encrypt: 是否是加密.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        blocksize = common.byte_size(rsa_key.n)</span><br><span class="line">        reserve_size = <span class="number">11</span>  <span class="comment"># 预留位为11</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> encrypt:  <span class="comment"># 解密时不需要考虑预留位</span></span><br><span class="line">            reserve_size = <span class="number">0</span></span><br><span class="line">        maxlength = blocksize - reserve_size</span><br><span class="line">        <span class="keyword">return</span> maxlength</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">encrypt_by_public_key</span>(<span class="params">self, message</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;使用公钥加密.</span></span><br><span class="line"><span class="string">            :param message: 需要加密的内容.</span></span><br><span class="line"><span class="string">            加密之后需要对接过进行base64转码</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        encrypt_result = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">        max_length = self.get_max_length(self.company_public_key)</span><br><span class="line">        <span class="keyword">while</span> message:</span><br><span class="line">            <span class="built_in">input</span> = message[:max_length]</span><br><span class="line">            message = message[max_length:]</span><br><span class="line">            out = rsa.encrypt(<span class="built_in">input</span>, self.company_public_key)</span><br><span class="line">            encrypt_result += out</span><br><span class="line">        encrypt_result = base64.b64encode(encrypt_result)</span><br><span class="line">        <span class="keyword">return</span> encrypt_result</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">decrypt_by_private_key</span>(<span class="params">self, message</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;使用私钥解密.</span></span><br><span class="line"><span class="string">            :param message: 需要加密的内容.</span></span><br><span class="line"><span class="string">            解密之后的内容直接是字符串，不需要在进行转义</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        decrypt_result = <span class="string">b&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        max_length = self.get_max_length(self.company_private_key, <span class="literal">False</span>)</span><br><span class="line">        decrypt_message = base64.b64decode(message)</span><br><span class="line">        <span class="keyword">while</span> decrypt_message:</span><br><span class="line">            <span class="built_in">input</span> = decrypt_message[:max_length]</span><br><span class="line">            decrypt_message = decrypt_message[max_length:]</span><br><span class="line">            out = rsa.decrypt(<span class="built_in">input</span>, self.company_private_key)</span><br><span class="line">            decrypt_result += out</span><br><span class="line">        <span class="keyword">return</span> decrypt_result</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sign_by_private_key</span>(<span class="params">self, data</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;私钥签名.</span></span><br><span class="line"><span class="string">            :param data: 需要签名的内容.</span></span><br><span class="line"><span class="string">            使用SHA-1 方法进行签名（也可以使用MD5）</span></span><br><span class="line"><span class="string">            签名之后，需要转义后输出</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        signature = rsa.sign(<span class="built_in">str</span>(data), priv_key=self.company_private_key, <span class="built_in">hash</span>=<span class="string">&#x27;SHA-1&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> base64.b64encode(signature)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">verify_by_public_key</span>(<span class="params">self, message, signature</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;公钥验签.</span></span><br><span class="line"><span class="string">            :param message: 验签的内容.</span></span><br><span class="line"><span class="string">            :param signature: 对验签内容签名的值（签名之后，会进行b64encode转码，所以验签前也需转码）.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        signature = base64.b64decode(signature)</span><br><span class="line">        <span class="keyword">return</span> rsa.verify(message, signature, self.company_public_key)</span><br></pre></td></tr></table></figure></p>]]></content>
    
    
    <summary type="html">加密都在加些啥东西呢</summary>
    
    
    
    <category term="知识点补充" scheme="https://my.wjtblog.online/categories/%E7%9F%A5%E8%AF%86%E7%82%B9%E8%A1%A5%E5%85%85/"/>
    
    
    <category term="技术" scheme="https://my.wjtblog.online/tags/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="逆向" scheme="https://my.wjtblog.online/tags/%E9%80%86%E5%90%91/"/>
    
    <category term="知识点补充" scheme="https://my.wjtblog.online/tags/%E7%9F%A5%E8%AF%86%E7%82%B9%E8%A1%A5%E5%85%85/"/>
    
  </entry>
  
  <entry>
    <title>小羊YZY</title>
    <link href="https://my.wjtblog.online/undefined/29dc1e17.html"/>
    <id>https://my.wjtblog.online/undefined/29dc1e17.html</id>
    <published>2022-09-14T11:29:16.000Z</published>
    <updated>2022-09-14T11:29:53.787Z</updated>
    
    <content type="html"><![CDATA[<div class="fj-gallery"><p><img src="/img/20220914 192856 小羊YZY/0.jpg" alt=""><br><img src="/img/20220914 192856 小羊YZY/1.jpg" alt=""><br><img src="/img/20220914 192856 小羊YZY/2.jpg" alt=""><br><img src="/img/20220914 192856 小羊YZY/3.jpg" alt=""><br><img src="/img/20220914 192856 小羊YZY/4.jpg" alt=""><br><img src="/img/20220914 192856 小羊YZY/5.jpg" alt=""><br><img src="/img/20220914 192856 小羊YZY/6.jpg" alt=""><br><img src="/img/20220914 192856 小羊YZY/7.jpg" alt=""><br><img src="/img/20220914 192856 小羊YZY/8.jpg" alt=""><br><img src="/img/20220914 192856 小羊YZY/9.jpg" alt=""><br><img src="/img/20220914 192856 小羊YZY/10.jpg" alt=""><br><img src="/img/20220914 192856 小羊YZY/11.jpg" alt=""><br><img src="/img/20220914 192856 小羊YZY/12.jpg" alt=""><br><img src="/img/20220914 192856 小羊YZY/13.jpg" alt=""><br><img src="/img/20220914 192856 小羊YZY/14.jpg" alt=""><br><img src="/img/20220914 192856 小羊YZY/15.jpg" alt=""><br><img src="/img/20220914 192856 小羊YZY/16.jpg" alt=""><br><img src="/img/20220914 192856 小羊YZY/17.jpg" alt=""><br><img src="/img/20220914 192856 小羊YZY/18.jpg" alt=""><br><img src="/img/20220914 192856 小羊YZY/19.jpg" alt=""><br><img src="/img/20220914 192856 小羊YZY/20.jpg" alt=""><br><img src="/img/20220914 192856 小羊YZY/21.jpg" alt=""><br><img src="/img/20220914 192856 小羊YZY/22.jpg" alt=""><br><img src="/img/20220914 192856 小羊YZY/23.jpg" alt=""><br><img src="/img/20220914 192856 小羊YZY/24.jpg" alt=""><br><img src="/img/20220914 192856 小羊YZY/25.jpg" alt=""><br><img src="/img/20220914 192856 小羊YZY/26.jpg" alt=""><br><img src="/img/20220914 192856 小羊YZY/27.jpg" alt=""><br><img src="/img/20220914 192856 小羊YZY/28.jpg" alt=""><br><img src="/img/20220914 192856 小羊YZY/29.jpg" alt=""><br><img src="/img/20220914 192856 小羊YZY/30.jpg" alt=""><br><img src="/img/20220914 192856 小羊YZY/31.jpg" alt=""><br><img src="/img/20220914 192856 小羊YZY/32.jpg" alt=""><br><img src="/img/20220914 192856 小羊YZY/33.jpg" alt=""><br><img src="/img/20220914 192856 小羊YZY/34.jpg" alt=""><br><img src="/img/20220914 192856 小羊YZY/35.jpg" alt=""><br><img src="/img/20220914 192856 小羊YZY/36.jpg" alt=""><br><img src="/img/20220914 192856 小羊YZY/37.jpg" alt=""><br><img src="/img/20220914 192856 小羊YZY/38.jpg" alt=""><br><img src="/img/20220914 192856 小羊YZY/39.jpg" alt=""><br><img src="/img/20220914 192856 小羊YZY/40.jpg" alt=""></p>          </div>]]></content>
    
    
    <summary type="html">我想对你说，你就是我的满天欢喜</summary>
    
    
    
    <category term="插画" scheme="https://my.wjtblog.online/categories/%E6%8F%92%E7%94%BB/"/>
    
    
    <category term="插画" scheme="https://my.wjtblog.online/tags/%E6%8F%92%E7%94%BB/"/>
    
  </entry>
  
  <entry>
    <title>逆向中补环境</title>
    <link href="https://my.wjtblog.online/undefined/278d18a4.html"/>
    <id>https://my.wjtblog.online/undefined/278d18a4.html</id>
    <published>2022-09-13T06:26:00.000Z</published>
    <updated>2022-09-14T11:40:12.066Z</updated>
    
    <content type="html"><![CDATA[<span class='p center logo large'>补环境知识点补充</span><h2 id="开始之前"><a href="#开始之前" class="headerlink" title="开始之前"></a>开始之前</h2><p>新的分类就从补环境开始吧，在这个专栏中会补充一些在逆向过程中会遇到的知识点<br>这些知识点应该要会而且必须要会</p><h2 id="浏览器环境"><a href="#浏览器环境" class="headerlink" title="浏览器环境"></a>浏览器环境</h2><p>我们在逆向之中最省时间的方法就是找到入口函数，然后将参数打上去直接运行<br>这种方法省时也省力<br>但往往这时候就会遇到 xxx is not defined<br>这是因为我们运行在nodejs环境中与浏览器的环境还是有很大不同（以谷歌浏览器为例）</p><p>1.全局下this的指向不同<br>浏览器下this指向window,nodejs中this指向global，所以window中封装的一些例如alert这些方法在nodejs中是无法使用的。</p><p>2.使用的引擎不一样；<br>不同的浏览器使用的引擎都是有差别的（所以应用会出现各种兼容性差异），但是Nodejs是基于谷歌的V8引擎的，引擎一致不管什么环境都不存在兼容性的问题。</p><p>3.javascript在浏览器中的主要作用是用来操作DOM的，而nodejs作为一门服务端的语言（类比PHP/JAVA），没有任务前台界面，所以不存在操作DOM。<br>也就是说两个使用起来的性质已经发生了变化，所以这方面来说基本没有可比性了。</p><p>4.使用的模块标准不同，nodejs使用的是CommonJs的模块标准，而浏览器使用的是ES的模块标准<br>所以nodejs中使用的是require()导入模块；浏览器中js使用的是import的方式导入</p><p>很多网站现在利用浏览器的特性来检测是否是机器操作<br>selenium等自动话操作手段固然能绕过这一检测但在面对高并发请求时就会显得心有余而力不足<br>所以补环境也是逆向这条路上很重要的知识点</p><h2 id="常见的检测环境"><a href="#常见的检测环境" class="headerlink" title="常见的检测环境"></a>常见的检测环境</h2><p>windows、location、navigate、document、native、canvas等等<br>常见的就是直接运行然后看什么not defined直接补充就好了<br>比较简单的如下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">var window = global;</span><br><span class="line">window.document = &#123;referrer: &quot;&quot;&#125;;</span><br><span class="line">window.location = &#123;</span><br><span class="line">    hash: &quot;&quot;,</span><br><span class="line">    host: &quot;&quot;,</span><br><span class="line">    hostname: &quot;&quot;,</span><br><span class="line">    href: &quot;&quot;,</span><br><span class="line">    origin: &quot;&quot;,</span><br><span class="line">    pathname: &quot;/&quot;,</span><br><span class="line">    port: &quot;&quot;,</span><br><span class="line">    protocol: &quot;https:&quot;,</span><br><span class="line">    search: &quot;&quot;</span><br><span class="line">&#125;;</span><br><span class="line">window.navigator = &#123;</span><br><span class="line">    appCodeName: &quot;Mozilla&quot;,</span><br><span class="line">    appName: &quot;Netscape&quot;,</span><br><span class="line">    appVersion: &quot;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.190 Safari/537.36&quot;,</span><br><span class="line">    cookieEnabled: true,</span><br><span class="line">    deviceMemory: 8,</span><br><span class="line">    doNotTrack: null,</span><br><span class="line">    hardwareConcurrency: 4,</span><br><span class="line">    language: &quot;zh-CN&quot;,</span><br><span class="line">    languages: [&quot;zh-CN&quot;, &quot;zh&quot;],</span><br><span class="line">    maxTouchPoints: 0,</span><br><span class="line">    onLine: true,</span><br><span class="line">    platform: &quot;Win32&quot;,</span><br><span class="line">    product: &quot;Gecko&quot;,</span><br><span class="line">    productSub: &quot;20030107&quot;,</span><br><span class="line">    userAgent: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.190 Safari/537.36&quot;,</span><br><span class="line">    vendor: &quot;Google Inc.&quot;,</span><br><span class="line">    vendorSub: &quot;&quot;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>但是这也不是万能的<br>就拿navigator对象中的 platform: “Win32” 举例<br>如果是我们自己构造的对象如<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">window.navigator = &#123;</span><br><span class="line">    platform: &quot;Win32&quot;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>这样子构建它就不能够直接通过检测（知乎x-zse-96​时检测）<br>那这就要引入原型链和对象的概念了<br>我们可以利用getOwnPropertyDescriptor函数来比较他们之间的差异s<br>getOwnPropertyDescriptor官方解释时s获取指定对象的自身属性描述符。自身属性描述符是指直接在对象上定义（而非从对象的原型继承）的描述符。<br>有点难懂 不过没事<br>我们通过谷歌浏览器的控制台输入以下代码<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var navigator1 = &#123;</span><br><span class="line">    platform :&quot;win32&quot;</span><br><span class="line">&#125;</span><br><span class="line">Object.getOwnPropertyDescriptor(navigator1,&quot;platform&quot;)</span><br></pre></td></tr></table></figure><br>再试试看原来是怎么定义的<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Object.getOwnPropertyDescriptor(navigator,&quot;platform&quot;)</span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="/img/buhuanjing/own.jpg"/></div></div><br>所以对于这样的代码检测，我们应该如何构造呢？<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var Navigator = function()&#123;&#125;;</span><br><span class="line">Navigator.prototype = &#123;&quot;platform&quot;: &quot;win32&quot;&#125;;</span><br><span class="line">navigator = new Navigator();</span><br><span class="line">Object.getOwnPropertyDescriptor(Navigator,&quot;platform&quot;)</span><br></pre></td></tr></table></figure></p><div class="img-wrap"><div class="img-bg"><img class="img" src="/img/buhuanjing/ownresult.jpg"/></div></div><p>这样就可以通过上面的原型链检测了</p><p>这里的​​platform​​​是​​Navigator​​​上的属性，在使用 new 实例化后，navigator.platform 取到的是继承自​​Navigator​​的属性值，而不是直接赋予该对象的属性，所以得到的结果和浏览器是一样的。</p><p>官方的意思是<br>在JS里，万物皆对象。方法（Function）是对象，方法的原型(Function.prototype)是对象。因此，它们都会具有对象共有的特点。即：对象具有属性<em> </em> proto <em> </em>，可称为隐式原型，一个对象的隐式原型指向构造该对象的构造函数的原型，这也保证了实例能够访问在构造函数原型中定义的属性和方法。</p><p>方法（Function）这个特殊的对象，除了和其他对象一样有上述<em>proto</em>属性之外，还有自己特有的属性——原型属性（prototype），这个属性是一个指针，指向一个对象，这个对象的用途就是包含所有实例共享的属性和方法（我们把这个对象叫做原型对象）。原型对象也有一个属性，叫做constructor，这个属性包含了一个指针，指回原构造函数。</p><p>想要理解这个可能有点困难看下边这个图<br><div class="img-wrap"><div class="img-bg"><img class="img" src="/img/buhuanjing/function.png"/></div></div><br>我们最后得出来这样的结论<br>xxx.<strong>proto</strong> == yyy.prototype<br>即我们分析一个对象就要分析它​<strong>proto</strong>​​​以及属性是定义在自己的​​prototype上还是继承自上一级</p><p>遇到这种的我们就可以Object.getOwnPropertyDescriptor()方法一个一个进行调试</p><p>以下给出常见的方法代码<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">document = &#123;</span><br><span class="line">    createElement:function(x)&#123;</span><br><span class="line">        return &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var _getXxx = &#123;</span><br><span class="line">    toString: function() &#123;</span><br><span class="line">        return &quot;&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">_getXxx.__proto__.getA = function getA(x) &#123;</span><br><span class="line">    return &#123;&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><p>给document补一些方法<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var document = &#123;</span><br><span class="line">    createEvent: function createEvent() &#123;&#125;,</span><br><span class="line">    addEventListener: function addEventListener(x) &#123;&#125;,</span><br><span class="line">    createElement: function createElement(x) &#123;</span><br><span class="line">        if(x===&quot;&quot;)&#123;&#125; else &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><br>给 getLX_method 对象增加方法<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var getLX_method = &#123;&#125;;</span><br><span class="line">getLX_method.__proto__.getExtension = function getExtension(x) &#123;</span><br><span class="line">    return &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">getLX_method.__proto__.getParameter = function getParameter(x) &#123;</span><br><span class="line">    return &quot;&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>补 canvas 的话，我们只需要看它调用的方法和返回的结果，然后去一次性绘制图片，取出base64值放到toDataURL()中即可。<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">document = &#123;</span><br><span class="line">createElement: function createElement(x) &#123;</span><br><span class="line">return canvas</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">canvas = &#123;</span><br><span class="line">toDataURL: function toDataURL() &#123;</span><br><span class="line">return &quot;data:image/png;base64,i.....ggg==&quot;</span><br><span class="line">&#125;,</span><br><span class="line">getContext: function getContext(x) &#123;</span><br><span class="line">        if (x === &quot;xxx&quot;) &#123;</span><br><span class="line">            return </span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            return CanvasContext </span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">CanvasContext = &#123;</span><br><span class="line">arc: function arc() &#123;&#125;,</span><br><span class="line">stroke: function stroke() &#123;&#125;,</span><br><span class="line">fillText: function fillText() &#123;&#125;,</span><br><span class="line">toString: function() &#123;</span><br><span class="line">        return &quot;[object]&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">canvas[Symbol.toStringTag] = &quot;HTMLCanvasElement&quot;;</span><br></pre></td></tr></table></figure></p><p>针对浏览器指纹额外提一下</p><p>浏览器指纹很重要，在数据采集、搜索引擎、埋点分析、网站测试等方面都有体现。</p><p>指纹通常是指服务端的为了做识别而收集的客户端设备信息。即使没有cookie，指纹也可用于识别个人用户或设备。</p><p>比如常用于记录的指纹 Header、Cookie、IP、DNS、UserAgent，Font（字体列表），Language，localStorage、Plugin（插件），Canvas（渲染绘图），WebGL（3D渲染图形），Web Vendor，Timezone（时区），WebRTC，ScreenResolution（分辨率），Platform（系统），Audio（音频设置和硬件特征指纹），以及enumerateDevices（其他媒体设备）、CPU、GPU信息等等。</p><p>像用户代理、HTML元素属性、Dom对象操作等都属于基本指纹。 像图形渲染、音频指纹、硬件指纹这些属于高级指纹，生成或者模拟都有一定难度。 像浏览记录、访问频率等属于行为指纹，常用于恶意访问的判定，具体判定规则需要测试。</p><p>当你浏览页面时，网站可以根据你的浏览器指纹进行跟踪，此外还有一些网站会根据指纹信息生成设备ID然后发送行为日志。 所以在你访问了一个网站后，它虽然没有cookie，但是有一个唯一的指纹，所以无论是推送广告还是行为检测都非常容易。</p><p>重写String的查找方法<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var _indexOf = String.prototype.indexOf;</span><br><span class="line">String.prototype.indexOf = function (searchValue, fromIndex) &#123;</span><br><span class="line">if (searchValue == &#x27;lx&#x27;) &#123;</span><br><span class="line">return-1;</span><br><span class="line">   &#125;</span><br><span class="line">       return _indexOf.apply(this, [searchValue, fromIndex]);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><br>重写toString方法：<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var newString = Function.prototype.toString;</span><br><span class="line">Function.prototype.toString = function () &#123;</span><br><span class="line">if (this == Window || this == Location || this == Function.prototype.toString) &#123;</span><br><span class="line">return&quot;function Window() &#123; [native code] &#125;&quot;;</span><br><span class="line">&#125;</span><br><span class="line">return newString.apply(this);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><br>还有就是可以使用proxy检测工具来看具体是定义在哪里的<br>proxy.js<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line">let _window = &#123;</span><br><span class="line">    </span><br><span class="line">&#125;;</span><br><span class="line">let _stringify = JSON.stringify;</span><br><span class="line">JSON.stringify = function (Object) &#123;</span><br><span class="line">    // ?? 的意思是，如果 ?? 左边的值是 null 或者 undefined，那么就返回右边的值。</span><br><span class="line">    if ((Object?.value ?? Object) === global) &#123;</span><br><span class="line">        return &quot;global&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    return _stringify(Object);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">function getMethodHandler(WatchName) &#123;</span><br><span class="line">    let methodhandler = &#123;</span><br><span class="line">        apply(target, thisArg, argArray) &#123;</span><br><span class="line">            let result = Reflect.apply(target, thisArg, argArray);</span><br><span class="line">            console.log(`[$&#123;WatchName&#125;] apply function name is [$&#123;target.name&#125;], argArray is [$&#123;argArray&#125;], result is [$&#123;result&#125;].`);</span><br><span class="line">            return result;</span><br><span class="line">        &#125;,</span><br><span class="line">        construct(target, argArray, newTarget) &#123;</span><br><span class="line">            let result = Reflect.construct(target, argArray, newTarget);</span><br><span class="line">            console.log(`[$&#123;WatchName&#125;] construct function name is [$&#123;target.name&#125;], argArray is [$&#123;argArray&#125;], result is [$&#123;JSON.stringify(result)&#125;].`);</span><br><span class="line">            return result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    return methodhandler;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function getObjHandler(WatchName) &#123;</span><br><span class="line">    let handler = &#123;</span><br><span class="line">        get(target, propKey, receiver) &#123;</span><br><span class="line">            let result = Reflect.get(target, propKey, receiver);</span><br><span class="line">            if (result instanceof Object) &#123;</span><br><span class="line">                if (typeof result === &quot;function&quot;) &#123;</span><br><span class="line">                    console.log(`[$&#123;WatchName&#125;] getting propKey is [$&#123;propKey&#125;] , it is function`);</span><br><span class="line">                    //return new Proxy(result,getMethodHandler(WatchName))</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    console.log(`[$&#123;WatchName&#125;] getting propKey is [$&#123;propKey&#125;], result is [$&#123;JSON.stringify(result)&#125;]`);</span><br><span class="line">                &#125;</span><br><span class="line">                return new Proxy(result, getObjHandler(`$&#123;WatchName&#125;.$&#123;propKey&#125;`));</span><br><span class="line">            &#125;</span><br><span class="line">            console.log(`[$&#123;WatchName&#125;] getting propKey is [$&#123;propKey&#125;], result is [$&#123;result&#125;]`);</span><br><span class="line">            return result;</span><br><span class="line">        &#125;,</span><br><span class="line">        set(target, propKey, value, receiver) &#123;</span><br><span class="line">            if (value instanceof Object) &#123;</span><br><span class="line">                console.log(`[$&#123;WatchName&#125;] setting propKey is [$&#123;propKey&#125;], value is [$&#123;JSON.stringify(value)&#125;]`);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                console.log(`[$&#123;WatchName&#125;] setting propKey is [$&#123;propKey&#125;], value is [$&#123;value&#125;]`);</span><br><span class="line">            &#125;</span><br><span class="line">            return Reflect.set(target, propKey, value, receiver);</span><br><span class="line">        &#125;,</span><br><span class="line">        has(target, propKey) &#123;</span><br><span class="line">            let result = Reflect.has(target, propKey);</span><br><span class="line">            console.log(`[$&#123;WatchName&#125;] has propKey [$&#123;propKey&#125;], result is [$&#123;result&#125;]`);</span><br><span class="line">            return result;</span><br><span class="line">        &#125;,</span><br><span class="line">        deleteProperty(target, propKey) &#123;</span><br><span class="line">            let result = Reflect.deleteProperty(target, propKey);</span><br><span class="line">            console.log(`[$&#123;WatchName&#125;] delete propKey [$&#123;propKey&#125;], result is [$&#123;result&#125;]`);</span><br><span class="line">            return result;</span><br><span class="line">        &#125;,</span><br><span class="line">        getOwnPropertyDescriptor(target, propKey) &#123;</span><br><span class="line">            let result = Reflect.getOwnPropertyDescriptor(target, propKey);</span><br><span class="line">            console.log(`[$&#123;WatchName&#125;] getOwnPropertyDescriptor  propKey [$&#123;propKey&#125;] result is [$&#123;JSON.stringify(result)&#125;]`);</span><br><span class="line">            return result;</span><br><span class="line">        &#125;,</span><br><span class="line">        defineProperty(target, propKey, attributes) &#123;</span><br><span class="line">            let result = Reflect.defineProperty(target, propKey, attributes);</span><br><span class="line">            console.log(`[$&#123;WatchName&#125;] defineProperty propKey [$&#123;propKey&#125;] attributes is [$&#123;JSON.stringify(attributes)&#125;], result is [$&#123;result&#125;]`);</span><br><span class="line">            return result;</span><br><span class="line">        &#125;,</span><br><span class="line">        getPrototypeOf(target) &#123;</span><br><span class="line">            let result = Reflect.getPrototypeOf(target);</span><br><span class="line">            console.log(`[$&#123;WatchName&#125;] getPrototypeOf result is [$&#123;JSON.stringify(result)&#125;]`);</span><br><span class="line">            return result;</span><br><span class="line">        &#125;,</span><br><span class="line">        setPrototypeOf(target, proto) &#123;</span><br><span class="line">            console.log(`[$&#123;WatchName&#125;] setPrototypeOf proto is [$&#123;JSON.stringify(proto)&#125;]`);</span><br><span class="line">            return Reflect.setPrototypeOf(target, proto);</span><br><span class="line">        &#125;,</span><br><span class="line">        preventExtensions(target) &#123;</span><br><span class="line">            console.log(`[$&#123;WatchName&#125;] preventExtensions`);</span><br><span class="line">            return Reflect.preventExtensions(target);</span><br><span class="line">        &#125;,</span><br><span class="line">        isExtensible(target) &#123;</span><br><span class="line">            let result = Reflect.isExtensible(target);</span><br><span class="line">            console.log(`[$&#123;WatchName&#125;] isExtensible, result is [$&#123;result&#125;]`);</span><br><span class="line">            return result;</span><br><span class="line">        &#125;,</span><br><span class="line">        ownKeys(target) &#123;</span><br><span class="line">            let result = Reflect.ownKeys(target);</span><br><span class="line">            console.log(`[$&#123;WatchName&#125;] invoke ownKeys, result is [$&#123;JSON.stringify(result)&#125;]`);</span><br><span class="line">            return result;</span><br><span class="line">        &#125;,</span><br><span class="line">        apply(target, thisArg, argArray) &#123;</span><br><span class="line">            let result = Reflect.apply(target, thisArg, argArray);</span><br><span class="line">            console.log(`[$&#123;WatchName&#125;] apply function name is [$&#123;target.name&#125;], argArray is [$&#123;argArray&#125;], result is [$&#123;result&#125;].`);</span><br><span class="line">            return result;</span><br><span class="line">        &#125;,</span><br><span class="line">        construct(target, argArray, newTarget) &#123;</span><br><span class="line">            let result = Reflect.construct(target, argArray, newTarget);</span><br><span class="line">            console.log(`[$&#123;WatchName&#125;] construct function name is [$&#123;target.name&#125;], argArray is [$&#123;argArray&#125;], result is [$&#123;JSON.stringify(result)&#125;].`);</span><br><span class="line">            return result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    return handler;</span><br><span class="line">&#125;</span><br><span class="line">_window = Object.assign(global, _window);</span><br><span class="line">const window = new Proxy(Object.create(_window), getObjHandler(&quot;window&quot;));</span><br><span class="line">module.exports = &#123;</span><br><span class="line">    window</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><br>要检测是直接使用<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const &#123;window&#125; = require(&quot;./tools/proxy&quot;);</span><br></pre></td></tr></table></figure></p><p>对于补环境来说最需要的还是耐心 逆向到了这步已经解决了十之八九了剩下的就得看自己耐心补充</p><p>当然也有捷径可以走比如说JSDOM对象<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// const canvas = require(&#x27;canvas&#x27;);</span><br><span class="line">const jsdom = require(&quot;jsdom&quot;);</span><br><span class="line">const &#123;JSDOM&#125; = jsdom;</span><br><span class="line">const dom = new JSDOM(`&lt;!DOCTYPE html&gt;&lt;p&gt;Hello world&lt;/p&gt;`);</span><br><span class="line">window = dom.window;</span><br><span class="line">document = window.document;</span><br><span class="line">XMLHttpRequest = window.XMLHttpRequest;</span><br><span class="line">navigator = window.navigator;</span><br><span class="line">location = window.location;</span><br><span class="line">history = window.history</span><br><span class="line">Window = window.Window</span><br><span class="line">Navigator  = window.Navigator</span><br></pre></td></tr></table></figure><br>在对于环境检测比较不严格的情况下这个往往能够直接解决<br>但是并不能算很好的方法</p><p>最后一种也可以说是通杀的方法就是直接selenium补充环境<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line">from selenium import webdriver</span><br><span class="line"></span><br><span class="line">ua = &#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64)...&#x27;</span><br><span class="line">PRO_DIR = os.path.dirname(os.path.abspath(__file__))</span><br><span class="line"></span><br><span class="line">s1 = &quot;&quot;&quot;</span><br><span class="line">    &lt;!DOCTYPE html&gt;</span><br><span class="line">    &lt;html style=&quot;font-size: 50px;&quot;&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;  </span><br><span class="line">        &lt;title&gt;signature-hook&lt;/title&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;&lt;/body&gt;</span><br><span class="line">    &lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">s2 = &quot;&quot;&quot;</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">    &lt;/html&gt;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">def driver_sig(html_file):</span><br><span class="line">    option = webdriver.ChromeOptions()</span><br><span class="line">    option.add_argument(&#x27;headless&#x27;)</span><br><span class="line">    option.add_argument(&#x27;--no-sandbox&#x27;)</span><br><span class="line">    option.add_argument(&#x27;--user-agent=&#123;&#125;&#x27;.format(ua))</span><br><span class="line">    driver = webdriver.Chrome(chrome_options=option)</span><br><span class="line">    driver.get(&#x27;file:///&#x27;+ PRO_DIR + html_file)</span><br><span class="line">    sig = driver.title</span><br><span class="line">    driver.quit()</span><br><span class="line">    return sig</span><br><span class="line"></span><br><span class="line">sign_js = &#x27;&#x27;&#x27;</span><br><span class="line">window.navigator = &#123;</span><br><span class="line">    userAgent: &#x27;&#x27;</span><br><span class="line">    &#125;;</span><br><span class="line">function get_sign() &#123;</span><br><span class="line">        ... //此处省略N行代码</span><br><span class="line">        return sign</span><br><span class="line">    &#125;</span><br><span class="line">var signature = get_sign();</span><br><span class="line">document.clear();</span><br><span class="line">document.write(signature);</span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    doc = sign_js.replace(&quot;userAgent: &#x27;&#x27;&quot;,&quot;userAgent: &#x27;&#123;&#125;&#x27;&quot;.format(ua))</span><br><span class="line">    html_file = &#x27;get_sign.html&#x27;</span><br><span class="line">    with open(html_file, &#x27;w&#x27;, encoding=&#x27;utf-8&#x27;) as fw:</span><br><span class="line">        fw.write(s1 + doc + s2)</span><br><span class="line">    sig = driver_sig(html_file)</span><br><span class="line">    print(sig)</span><br></pre></td></tr></table></figure><br>在这种情况下基本可以秒杀市面上大多数的网站检测</p><p>借用lx老师的话来总结有关js逆向补环境</p><p>1、检测环境记心里，指纹信息重获取。</p><p>2、dom操作记一记，Jsdom多练习。</p><p>3、不可变对象记得Object.freeze()</p><p>4、多用debugger巧用proxy</p><p>5、内置方法防重写</p><p>6、形成框架方便二次修改</p>]]></content>
    
    
    <summary type="html">小tips你一定用得上</summary>
    
    
    
    <category term="知识点补充" scheme="https://my.wjtblog.online/categories/%E7%9F%A5%E8%AF%86%E7%82%B9%E8%A1%A5%E5%85%85/"/>
    
    
    <category term="技术" scheme="https://my.wjtblog.online/tags/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="逆向" scheme="https://my.wjtblog.online/tags/%E9%80%86%E5%90%91/"/>
    
    <category term="知识点补充" scheme="https://my.wjtblog.online/tags/%E7%9F%A5%E8%AF%86%E7%82%B9%E8%A1%A5%E5%85%85/"/>
    
  </entry>
  
  <entry>
    <title>画师 鱼千会画画</title>
    <link href="https://my.wjtblog.online/undefined/78b5d518.html"/>
    <id>https://my.wjtblog.online/undefined/78b5d518.html</id>
    <published>2022-09-12T00:50:09.000Z</published>
    <updated>2022-09-13T11:29:02.001Z</updated>
    
    <content type="html"><![CDATA[<div class="fj-gallery"><p><img src="/img/20220912 084949 画师 鱼千会画画/0.jpg" alt=""><br><img src="/img/20220912 084949 画师 鱼千会画画/1.jpg" alt=""><br><img src="/img/20220912 084949 画师 鱼千会画画/2.jpg" alt=""><br><img src="/img/20220912 084949 画师 鱼千会画画/3.jpg" alt=""><br><img src="/img/20220912 084949 画师 鱼千会画画/4.jpg" alt=""><br><img src="/img/20220912 084949 画师 鱼千会画画/5.jpg" alt=""><br><img src="/img/20220912 084949 画师 鱼千会画画/6.jpg" alt=""><br><img src="/img/20220912 084949 画师 鱼千会画画/7.jpg" alt=""><br><img src="/img/20220912 084949 画师 鱼千会画画/8.jpg" alt=""><br><img src="/img/20220912 084949 画师 鱼千会画画/9.jpg" alt=""><br><img src="/img/20220912 084949 画师 鱼千会画画/10.jpg" alt=""><br><img src="/img/20220912 084949 画师 鱼千会画画/11.jpg" alt=""><br><img src="/img/20220912 084949 画师 鱼千会画画/12.jpg" alt=""><br><img src="/img/20220912 084949 画师 鱼千会画画/13.jpg" alt=""><br><img src="/img/20220912 084949 画师 鱼千会画画/14.jpg" alt=""><br><img src="/img/20220912 084949 画师 鱼千会画画/15.jpg" alt=""><br><img src="/img/20220912 084949 画师 鱼千会画画/16.jpg" alt=""><br><img src="/img/20220912 084949 画师 鱼千会画画/17.jpg" alt=""><br><img src="/img/20220912 084949 画师 鱼千会画画/18.jpg" alt=""><br><img src="/img/20220912 084949 画师 鱼千会画画/19.jpg" alt=""><br><img src="/img/20220912 084949 画师 鱼千会画画/20.jpg" alt=""><br><img src="/img/20220912 084949 画师 鱼千会画画/21.jpg" alt=""><br><img src="/img/20220912 084949 画师 鱼千会画画/22.jpg" alt=""><br><img src="/img/20220912 084949 画师 鱼千会画画/23.jpg" alt=""><br><img src="/img/20220912 084949 画师 鱼千会画画/24.jpg" alt=""><br><img src="/img/20220912 084949 画师 鱼千会画画/25.jpg" alt=""><br><img src="/img/20220912 084949 画师 鱼千会画画/26.jpg" alt=""><br><img src="/img/20220912 084949 画师 鱼千会画画/27.jpg" alt=""><br><img src="/img/20220912 084949 画师 鱼千会画画/28.jpg" alt=""><br><img src="/img/20220912 084949 画师 鱼千会画画/29.jpg" alt=""><br><img src="/img/20220912 084949 画师 鱼千会画画/30.jpg" alt=""><br><img src="/img/20220912 084949 画师 鱼千会画画/31.jpg" alt=""><br><img src="/img/20220912 084949 画师 鱼千会画画/32.jpg" alt=""></p>          </div>]]></content>
    
    
    <summary type="html">他们说这里曾有一对恋人</summary>
    
    
    
    <category term="插画" scheme="https://my.wjtblog.online/categories/%E6%8F%92%E7%94%BB/"/>
    
    
    <category term="插画" scheme="https://my.wjtblog.online/tags/%E6%8F%92%E7%94%BB/"/>
    
  </entry>
  
  <entry>
    <title>遇见不一样的风景</title>
    <link href="https://my.wjtblog.online/undefined/dfa7a566.html"/>
    <id>https://my.wjtblog.online/undefined/dfa7a566.html</id>
    <published>2022-09-11T00:18:28.000Z</published>
    <updated>2022-09-13T11:29:08.375Z</updated>
    
    <content type="html"><![CDATA[<div class="fj-gallery"><p><img src="/img/20220911 081818 遇见不一样的风景/0.jpg" alt=""><br><img src="/img/20220911 081818 遇见不一样的风景/1.jpg" alt=""><br><img src="/img/20220911 081818 遇见不一样的风景/2.jpg" alt=""><br><img src="/img/20220911 081818 遇见不一样的风景/3.jpg" alt=""><br><img src="/img/20220911 081818 遇见不一样的风景/4.jpg" alt=""><br><img src="/img/20220911 081818 遇见不一样的风景/5.jpg" alt=""><br><img src="/img/20220911 081818 遇见不一样的风景/6.jpg" alt=""><br><img src="/img/20220911 081818 遇见不一样的风景/7.jpg" alt=""><br><img src="/img/20220911 081818 遇见不一样的风景/8.jpg" alt=""><br><img src="/img/20220911 081818 遇见不一样的风景/9.jpg" alt=""><br><img src="/img/20220911 081818 遇见不一样的风景/10.jpg" alt=""><br><img src="/img/20220911 081818 遇见不一样的风景/11.jpg" alt=""><br><img src="/img/20220911 081818 遇见不一样的风景/12.jpg" alt=""><br><img src="/img/20220911 081818 遇见不一样的风景/13.jpg" alt=""><br><img src="/img/20220911 081818 遇见不一样的风景/14.jpg" alt=""><br><img src="/img/20220911 081818 遇见不一样的风景/15.jpg" alt=""><br><img src="/img/20220911 081818 遇见不一样的风景/16.jpg" alt=""><br><img src="/img/20220911 081818 遇见不一样的风景/17.jpg" alt=""><br><img src="/img/20220911 081818 遇见不一样的风景/18.jpg" alt=""><br><img src="/img/20220911 081818 遇见不一样的风景/19.jpg" alt=""><br><img src="/img/20220911 081818 遇见不一样的风景/20.jpg" alt=""><br><img src="/img/20220911 081818 遇见不一样的风景/21.jpg" alt=""><br><img src="/img/20220911 081818 遇见不一样的风景/22.jpg" alt=""><br><img src="/img/20220911 081818 遇见不一样的风景/23.jpg" alt=""><br><img src="/img/20220911 081818 遇见不一样的风景/24.jpg" alt=""><br><img src="/img/20220911 081818 遇见不一样的风景/25.jpg" alt=""><br><img src="/img/20220911 081818 遇见不一样的风景/26.jpg" alt=""><br><img src="/img/20220911 081818 遇见不一样的风景/27.jpg" alt=""><br><img src="/img/20220911 081818 遇见不一样的风景/28.jpg" alt=""><br><img src="/img/20220911 081818 遇见不一样的风景/29.jpg" alt=""><br><img src="/img/20220911 081818 遇见不一样的风景/30.jpg" alt=""><br><img src="/img/20220911 081818 遇见不一样的风景/31.jpg" alt=""></p>          </div>]]></content>
    
    
    <summary type="html">愿美好的瞬间都有人分享</summary>
    
    
    
    <category term="插画" scheme="https://my.wjtblog.online/categories/%E6%8F%92%E7%94%BB/"/>
    
    
    <category term="插画" scheme="https://my.wjtblog.online/tags/%E6%8F%92%E7%94%BB/"/>
    
  </entry>
  
  <entry>
    <title>中秋节 教师节快乐！</title>
    <link href="https://my.wjtblog.online/undefined/52ed70a5.html"/>
    <id>https://my.wjtblog.online/undefined/52ed70a5.html</id>
    <published>2022-09-10T01:31:08.000Z</published>
    <updated>2022-09-13T11:29:13.769Z</updated>
    
    <content type="html"><![CDATA[<div class="fj-gallery"><p><img src="/img/20220910 093100 中秋节 教师节快乐！/0.jpg" alt=""><br><img src="/img/20220910 093100 中秋节 教师节快乐！/1.jpg" alt=""><br><img src="/img/20220910 093100 中秋节 教师节快乐！/2.jpg" alt=""><br><img src="/img/20220910 093100 中秋节 教师节快乐！/3.jpg" alt=""><br><img src="/img/20220910 093100 中秋节 教师节快乐！/4.jpg" alt=""><br><img src="/img/20220910 093100 中秋节 教师节快乐！/5.jpg" alt=""><br><img src="/img/20220910 093100 中秋节 教师节快乐！/6.jpg" alt=""><br><img src="/img/20220910 093100 中秋节 教师节快乐！/7.jpg" alt=""><br><img src="/img/20220910 093100 中秋节 教师节快乐！/8.jpg" alt=""><br><img src="/img/20220910 093100 中秋节 教师节快乐！/9.jpg" alt=""><br><img src="/img/20220910 093100 中秋节 教师节快乐！/10.jpg" alt=""><br><img src="/img/20220910 093100 中秋节 教师节快乐！/11.jpg" alt=""><br><img src="/img/20220910 093100 中秋节 教师节快乐！/12.jpg" alt=""><br><img src="/img/20220910 093100 中秋节 教师节快乐！/13.jpg" alt=""><br><img src="/img/20220910 093100 中秋节 教师节快乐！/14.jpg" alt=""><br><img src="/img/20220910 093100 中秋节 教师节快乐！/15.jpg" alt=""><br><img src="/img/20220910 093100 中秋节 教师节快乐！/16.jpg" alt=""><br><img src="/img/20220910 093100 中秋节 教师节快乐！/17.jpg" alt=""><br><img src="/img/20220910 093100 中秋节 教师节快乐！/18.jpg" alt=""><br><img src="/img/20220910 093100 中秋节 教师节快乐！/19.jpg" alt=""><br><img src="/img/20220910 093100 中秋节 教师节快乐！/20.jpg" alt=""></p>          </div>]]></content>
    
    
    <summary type="html">今天放下手中的码陪陪家人呦</summary>
    
    
    
    <category term="插画" scheme="https://my.wjtblog.online/categories/%E6%8F%92%E7%94%BB/"/>
    
    
    <category term="插画" scheme="https://my.wjtblog.online/tags/%E6%8F%92%E7%94%BB/"/>
    
  </entry>
  
  <entry>
    <title>某猫去水印小程序逆向</title>
    <link href="https://my.wjtblog.online/undefined/c0285f80.html"/>
    <id>https://my.wjtblog.online/undefined/c0285f80.html</id>
    <published>2022-09-09T05:46:00.000Z</published>
    <updated>2022-09-09T11:15:30.604Z</updated>
    
    <content type="html"><![CDATA[<span class='p center logo large'>某猫去水印小程序加密参数逆向</span><h2 id="开始之前"><a href="#开始之前" class="headerlink" title="开始之前"></a>开始之前</h2><p>在有些时候我们刷某红薯、某音等等的时候，遇到一些好看的图片、视频我们想保存下来。做壁纸或者…..<br>咳咳咳<br>我们会发现有个很讨厌的水印，很影响美观<br>这时候就有很多网上的去水印的小程序之类的（绝对不是我偷懒不去看他们的参数）<br>本次的主要解析对象就是某红薯上的图片<br>之前web端还能显示的时候是没有水印的<br>加密也仅仅是替换一个id<br>在一次更新过后整个web端都有水印了<br>在看了app端和小程序端之后我果断选择最简单的第三方去水印的小程序——某猫去水印<br>我们自己用的原则就是怎么简单怎么来！</p><h2 id="手机抓包"><a href="#手机抓包" class="headerlink" title="手机抓包"></a>手机抓包</h2><p>对于小程序端的逆向，我们需要一部低版本的安卓手机设置起来比较方便<br>用的是mitmproxy这个软件 当然fiddler等等的抓包软件也是可以的<br>关于mitmproxy的抓包设置我就不过多赘述了，感兴趣的可以看看以下文章<br><div class="tag link"><a class="link-card" title="mitmproxy使用详解" href="https://blog.csdn.net/shifengboy/article/details/114067212"><div class="left"><img src="/img/siteicon/64.png"/></div><div class="right"><p class="text">mitmproxy使用详解</p><p class="url">https://blog.csdn.net/shifengboy/article/details/114067212</p></div></a></div></p><p>照例我们先来抓个包<br><div class="img-wrap"><div class="img-bg"><img class="img" src="/img/miniprogram/mintproxy.jpg"/></div></div><br>看参数还算清楚<br>一个是token还不知道是怎么生成的<br>另一个url就是我们粘贴的链接了<br>我们拉到postman去测试一下<br><div class="img-wrap"><div class="img-bg"><img class="img" src="/img/miniprogram/new.jpg"/></div></div><br>返回来code=001 说的未知错误，那应该就是token反爬了<br>试了几次注意到好像是以分钟为单位的变化那试试看MD5加密（32位的加密字符可能是MD5加密）<br>果然是没这么简单<br>接下来就老老实实的逆向小程序</p><h2 id="小程序逆向"><a href="#小程序逆向" class="headerlink" title="小程序逆向"></a>小程序逆向</h2><p>小程序的逆向一共分为三步</p><h3 id="还原小程序代码"><a href="#还原小程序代码" class="headerlink" title="还原小程序代码"></a>还原小程序代码</h3><p>小程序代码的还原首先需要我们找到小程序的pkg包<br>小程序pkg包都是以wxapkg后缀为结尾的文件<br>有两种方法可以获取</p><h4 id="模拟器-手机获取"><a href="#模拟器-手机获取" class="headerlink" title="模拟器/手机获取"></a>模拟器/手机获取</h4><p>我们安装完模拟器后进入小程序，确保小程序加载完之后我们使用RE文件管理器深度搜索wxapkg关键词<br>一般的路径都为\data\com.tencent.mm\MicroMsg\微信id\appbrand\pkg<br>之后可以借助模拟器共享空间或者adb命令之后传出来，方便后续使用<br>（这种方法不太推荐，模拟器登录wx有封号的风险，不要问我为啥知道的 血的教训）</p><h4 id="PC端"><a href="#PC端" class="headerlink" title="PC端"></a>PC端</h4><p>PC端的微信小程序包一般路径在\文档\Wechat Files\Applet\wxxxxxxxxxxxxxxxx这个路径下<br>与手机和模拟器不同的是这个wxapkg是加密的我们需多进行一步解密的过程<br>这里给大家提供一个工具UnpackMiniApp<br><div class="tag link"><a class="link-card" title="UnpackMiniApp" href="https://pan.baidu.com/s/1dwUehOAnPka9eHjXN6Y-Lg?pwd=unp7"><div class="left"><img src="/img/siteicon/64.png"/></div><div class="right"><p class="text">UnpackMiniApp</p><p class="url">https://pan.baidu.com/s/1dwUehOAnPka9eHjXN6Y-Lg?pwd=unp7</p></div></a></div><br>傻瓜可视化操作即可<br>在源目录的解析wxapkg包！！！<br>这个很关键不然签名异常<br>紧接着点击<br>UnpackMiniApp.exe文件<br>如图所示<br><div class="img-wrap"><div class="img-bg"><img class="img" src="/img/miniprogram/unpackminiapp.jpg"/></div></div><br>在包到\UnpackMiniApp\UnpackMiniApp\wxpack\这个目录下就会生成一个wxapkg包<br>紧接着再使用CrackMinApp来编译成我们最后的小程序源码<br><div class="tag link"><a class="link-card" title="CrackMinApp" href="https://github.com/Cherrison/CrackMinApp"><div class="left"><img src="/img/siteicon/64.png"/></div><div class="right"><p class="text">CrackMinApp</p><p class="url">https://github.com/Cherrison/CrackMinApp</p></div></a></div><br>将刚才生成的wxapkg文件复制到\CrackMinApp\CrackMinApp\wxapkg目录下<br>点击exe文件进行解析<br><div class="img-wrap"><div class="img-bg"><img class="img" src="/img/miniprogram/uncarckminiapp.jpg"/></div></div><br>此时会发现在\CrackMinApp\CrackMinApp\wxapkg目录下额外生成了一个新的目录就是源码了<br><div class="img-wrap"><div class="img-bg"><img class="img" src="/img/miniprogram/file.jpg"/></div></div><br>还有一种情况<br>没有生成文件夹时<br>因为部分环境不支持&amp;exit的语法我们就需要手动进行编译<br>我们我需要进入nodejs/nodejs中，我们需先配置到nodejs环境<br>具体可以看这篇文章<br><div class="tag link"><a class="link-card" title="Nodejs安装教程" href="https://www.runoob.com/nodejs/nodejs-install-setup.html"><div class="left"><img src="/img/siteicon/64.png"/></div><div class="right"><p class="text">Nodejs安装教程</p><p class="url">https://www.runoob.com/nodejs/nodejs-install-setup.html</p></div></a></div><br>配置好环境之后我们就cmd进去<br>执行以下命令<br><div class="img-wrap"><div class="img-bg"><img class="img" src="/img/miniprogram/nodejs.jpg"/></div></div><br>如果报错就看缺啥npm install就好了<br>之后就能得到小程序的我源码了</p><h3 id="配置小程序环境"><a href="#配置小程序环境" class="headerlink" title="配置小程序环境"></a>配置小程序环境</h3><p>我们打开微信开发者工具<br><div class="img-wrap"><div class="img-bg"><img class="img" src="/img/miniprogram/mini.jpg"/></div></div><br>没接触过的可以看看微信开放文档<br><div class="tag link"><a class="link-card" title="微信开放文档" href="https://developers.weixin.qq.com/miniprogram/dev/framework/"><div class="left"><img src="/img/siteicon/64.png"/></div><div class="right"><p class="text">微信开放文档</p><p class="url">https://developers.weixin.qq.com/miniprogram/dev/framework/</p></div></a></div><br>进去之后极大可能是啥也打不开的<br>很正常，基本上是工具版本、环境因素造成的<br>慢慢根据报错配置就好<br>特别注意要把本地设置中的不校验合法域名勾选上<br><div class="img-wrap"><div class="img-bg"><img class="img" src="/img/miniprogram/bujiaoyan.jpg"/></div></div><br>让我们观察一下路由文件app.json<br><div class="img-wrap"><div class="img-bg"><img class="img" src="/img/miniprogram/pages.jpg"/></div></div><br>其中pages代表的就是页面的路由<br>排在最前面的就是入口页面<br>我们全局搜索一下 立刻解析 这四个字<br><div class="img-wrap"><div class="img-bg"><img class="img" src="/img/miniprogram/searchjiexi.jpg"/></div></div><br>在这边我们直接把这个页面的路径放在第一个编译就是这个页面了<br>我们观察一下立刻解析这个按钮触发的函数<br><div class="img-wrap"><div class="img-bg"><img class="img" src="/img/miniprogram/bindtap.jpg"/></div></div><br>是batch这个函数<br>其中的js路径就是在pages/batch/index.js这个路径下<br><div class="img-wrap"><div class="img-bg"><img class="img" src="/img/miniprogram/pathjs.jpg"/></div></div><br>进去之后就搜索我们想要的值token<br><div class="img-wrap"><div class="img-bg"><img class="img" src="/img/miniprogram/uri.jpg"/></div></div><br>这个就是我们要的了<br>往上观察一下<br><div class="img-wrap"><div class="img-bg"><img class="img" src="/img/miniprogram/key.jpg"/></div></div><br>i果然是以分钟为单位的<br>r = e.default.kage(wx.getAccountInfoSync().miniProgram.appId).slice(16)<br>这个就是小程序的语法了 具体的就是获取小程序的appId然后去搞个加密之后再slice一下 先放着一会看看<br>u就是uid了uid在抓包是我们就找到了可以设个定值<br>那我们解决一下e.default.kage这个语法就好了<br>我们consle.log(e.default.kage)<br><div class="img-wrap"><div class="img-bg"><img class="img" src="/img/miniprogram/r.jpg"/></div></div><br>定位到这里<br>这个看起来很简单直接把他复制到本地封装一下，直接把那个传进去，过程我们也不操心 能用就行！<br>果然返回了一个32位的加密值我们去postman上试试看<br>可惜还是不行<br>后来检查的时候发现miniProgram.appId这个id我用的我自己的<br>但其实应该用这个小程序的到小程序上ctrl c ctrl v回来<br>果然可以<br>那之后就简单了用封装成函数 到python中execjc一调<br><div class="img-wrap"><div class="img-bg"><img class="img" src="/img/miniprogram/result.jpg"/></div></div><br>ok结束<br>爬下来了顺便就贴出来吧<br><div class="fj-gallery"><p><img src="/img/miniprogram/0.jpg" alt=""><br><img src="/img/miniprogram/1.jpg" alt=""><br><img src="/img/miniprogram/2.jpg" alt=""><br><img src="/img/miniprogram/3.jpg" alt=""><br><img src="/img/miniprogram/4.jpg" alt=""><br><img src="/img/miniprogram/5.jpg" alt=""><br><img src="/img/miniprogram/6.jpg" alt=""><br><img src="/img/miniprogram/7.jpg" alt=""></p>          </div></p><h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><span class='p left h4'>现在越来越多的厂家都转到app端和小程序端了，web端能获取的数据会越来越少，这也是大势所趋，所以移动端的逆向知识一定得学起来!另外在中秋节前夕 祝愿大家中秋快乐！</span>]]></content>
    
    
    <summary type="html">小程序！小程序！小程序！</summary>
    
    
    
    <category term="逆向" scheme="https://my.wjtblog.online/categories/%E9%80%86%E5%90%91/"/>
    
    
    <category term="技术" scheme="https://my.wjtblog.online/tags/%E6%8A%80%E6%9C%AF/"/>
    
  </entry>
  
  <entry>
    <title>啊帐的画廊</title>
    <link href="https://my.wjtblog.online/undefined/3be073bc.html"/>
    <id>https://my.wjtblog.online/undefined/3be073bc.html</id>
    <published>2022-09-09T03:42:01.000Z</published>
    <updated>2022-09-13T11:28:57.327Z</updated>
    
    <content type="html"><![CDATA[<div class="fj-gallery"><p><img src="/img/20220909 114150 啊帐的画廊/0.jpg" alt=""><br><img src="/img/20220909 114150 啊帐的画廊/1.jpg" alt=""><br><img src="/img/20220909 114150 啊帐的画廊/2.jpg" alt=""><br><img src="/img/20220909 114150 啊帐的画廊/3.jpg" alt=""><br><img src="/img/20220909 114150 啊帐的画廊/4.jpg" alt=""><br><img src="/img/20220909 114150 啊帐的画廊/5.jpg" alt=""><br><img src="/img/20220909 114150 啊帐的画廊/6.jpg" alt=""><br><img src="/img/20220909 114150 啊帐的画廊/7.jpg" alt=""><br><img src="/img/20220909 114150 啊帐的画廊/8.jpg" alt=""><br><img src="/img/20220909 114150 啊帐的画廊/9.jpg" alt=""><br><img src="/img/20220909 114150 啊帐的画廊/10.jpg" alt=""><br><img src="/img/20220909 114150 啊帐的画廊/11.jpg" alt=""><br><img src="/img/20220909 114150 啊帐的画廊/12.jpg" alt=""><br><img src="/img/20220909 114150 啊帐的画廊/13.jpg" alt=""><br><img src="/img/20220909 114150 啊帐的画廊/14.jpg" alt=""><br><img src="/img/20220909 114150 啊帐的画廊/15.jpg" alt=""><br><img src="/img/20220909 114150 啊帐的画廊/16.jpg" alt=""><br><img src="/img/20220909 114150 啊帐的画廊/17.jpg" alt=""><br><img src="/img/20220909 114150 啊帐的画廊/18.jpg" alt=""><br><img src="/img/20220909 114150 啊帐的画廊/19.jpg" alt=""><br><img src="/img/20220909 114150 啊帐的画廊/20.jpg" alt=""><br><img src="/img/20220909 114150 啊帐的画廊/21.jpg" alt=""><br><img src="/img/20220909 114150 啊帐的画廊/22.jpg" alt=""><br><img src="/img/20220909 114150 啊帐的画廊/23.jpg" alt=""><br><img src="/img/20220909 114150 啊帐的画廊/24.jpg" alt=""><br><img src="/img/20220909 114150 啊帐的画廊/25.jpg" alt=""><br><img src="/img/20220909 114150 啊帐的画廊/26.jpg" alt=""><br><img src="/img/20220909 114150 啊帐的画廊/27.jpg" alt=""><br><img src="/img/20220909 114150 啊帐的画廊/28.jpg" alt=""><br><img src="/img/20220909 114150 啊帐的画廊/29.jpg" alt=""><br><img src="/img/20220909 114150 啊帐的画廊/30.jpg" alt=""></p>          </div>]]></content>
    
    
    <summary type="html">祝大伙中秋节快乐呀</summary>
    
    
    
    <category term="插画" scheme="https://my.wjtblog.online/categories/%E6%8F%92%E7%94%BB/"/>
    
    
    <category term="插画" scheme="https://my.wjtblog.online/tags/%E6%8F%92%E7%94%BB/"/>
    
  </entry>
  
  <entry>
    <title>ai画作 Mews.</title>
    <link href="https://my.wjtblog.online/undefined/4ad61758.html"/>
    <id>https://my.wjtblog.online/undefined/4ad61758.html</id>
    <published>2022-09-08T11:39:08.000Z</published>
    <updated>2022-09-13T11:29:16.651Z</updated>
    
    <content type="html"><![CDATA[<div class="fj-gallery"><p><img src="/img/20220908 193857 ai画作 Mews/0.jpg" alt=""><br><img src="/img/20220908 193857 ai画作 Mews/1.jpg" alt=""><br><img src="/img/20220908 193857 ai画作 Mews/2.jpg" alt=""><br><img src="/img/20220908 193857 ai画作 Mews/3.jpg" alt=""><br><img src="/img/20220908 193857 ai画作 Mews/4.jpg" alt=""><br><img src="/img/20220908 193857 ai画作 Mews/5.jpg" alt=""><br><img src="/img/20220908 193857 ai画作 Mews/6.jpg" alt=""><br><img src="/img/20220908 193857 ai画作 Mews/7.jpg" alt=""><br><img src="/img/20220908 193857 ai画作 Mews/8.jpg" alt=""><br><img src="/img/20220908 193857 ai画作 Mews/9.jpg" alt=""><br><img src="/img/20220908 193857 ai画作 Mews/10.jpg" alt=""><br><img src="/img/20220908 193857 ai画作 Mews/11.jpg" alt=""><br><img src="/img/20220908 193857 ai画作 Mews/12.jpg" alt=""><br><img src="/img/20220908 193857 ai画作 Mews/13.jpg" alt=""><br><img src="/img/20220908 193857 ai画作 Mews/14.jpg" alt=""><br><img src="/img/20220908 193857 ai画作 Mews/15.jpg" alt=""><br><img src="/img/20220908 193857 ai画作 Mews/16.jpg" alt=""><br><img src="/img/20220908 193857 ai画作 Mews/17.jpg" alt=""><br><img src="/img/20220908 193857 ai画作 Mews/18.jpg" alt=""><br><img src="/img/20220908 193857 ai画作 Mews/19.jpg" alt=""><br><img src="/img/20220908 193857 ai画作 Mews/20.jpg" alt=""><br><img src="/img/20220908 193857 ai画作 Mews/21.jpg" alt=""><br><img src="/img/20220908 193857 ai画作 Mews/22.jpg" alt=""></p>          </div>]]></content>
    
    
    <summary type="html">今天是治愈系ai画作哦~</summary>
    
    
    
    <category term="插画" scheme="https://my.wjtblog.online/categories/%E6%8F%92%E7%94%BB/"/>
    
    
    <category term="插画" scheme="https://my.wjtblog.online/tags/%E6%8F%92%E7%94%BB/"/>
    
  </entry>
  
  <entry>
    <title>画师 DeadPrince</title>
    <link href="https://my.wjtblog.online/undefined/9e8f19f9.html"/>
    <id>https://my.wjtblog.online/undefined/9e8f19f9.html</id>
    <published>2022-09-07T06:25:21.000Z</published>
    <updated>2022-09-13T11:29:05.900Z</updated>
    
    <content type="html"><![CDATA[<div class="fj-gallery"><p><img src="/img/20220907 142521 画师 DeadPrince/0.jpg" alt=""><br><img src="/img/20220907 142521 画师 DeadPrince/1.jpg" alt=""><br><img src="/img/20220907 142521 画师 DeadPrince/2.jpg" alt=""><br><img src="/img/20220907 142521 画师 DeadPrince/3.jpg" alt=""><br><img src="/img/20220907 142521 画师 DeadPrince/4.jpg" alt=""><br><img src="/img/20220907 142521 画师 DeadPrince/5.jpg" alt=""><br><img src="/img/20220907 142521 画师 DeadPrince/6.jpg" alt=""></p>          </div>]]></content>
    
    
    <summary type="html">爆裂双重美感 甜酷辣妹的二次元</summary>
    
    
    
    <category term="插画" scheme="https://my.wjtblog.online/categories/%E6%8F%92%E7%94%BB/"/>
    
    
    <category term="二次元" scheme="https://my.wjtblog.online/tags/%E4%BA%8C%E6%AC%A1%E5%85%83/"/>
    
  </entry>
  
  <entry>
    <title>原神 torino</title>
    <link href="https://my.wjtblog.online/undefined/daf3f053.html"/>
    <id>https://my.wjtblog.online/undefined/daf3f053.html</id>
    <published>2022-09-06T03:05:04.000Z</published>
    <updated>2022-09-13T11:29:10.881Z</updated>
    
    <content type="html"><![CDATA[<div class="fj-gallery"><p><img src="/img/20220906 110503 原神 torino/0.jpg" alt=""><br><img src="/img/20220906 110503 原神 torino/1.jpg" alt=""><br><img src="/img/20220906 110503 原神 torino/2.jpg" alt=""><br><img src="/img/20220906 110503 原神 torino/3.jpg" alt=""><br><img src="/img/20220906 110503 原神 torino/4.jpg" alt=""><br><img src="/img/20220906 110503 原神 torino/5.jpg" alt=""><br><img src="/img/20220906 110503 原神 torino/6.jpg" alt=""><br><img src="/img/20220906 110503 原神 torino/7.jpg" alt=""><br><img src="/img/20220906 110503 原神 torino/8.jpg" alt=""><br><img src="/img/20220906 110503 原神 torino/9.jpg" alt=""><br><img src="/img/20220906 110503 原神 torino/10.jpg" alt=""><br><img src="/img/20220906 110503 原神 torino/11.jpg" alt=""><br><img src="/img/20220906 110503 原神 torino/12.jpg" alt=""><br><img src="/img/20220906 110503 原神 torino/13.jpg" alt=""><br><img src="/img/20220906 110503 原神 torino/14.jpg" alt=""><br><img src="/img/20220906 110503 原神 torino/15.jpg" alt=""><br><img src="/img/20220906 110503 原神 torino/16.jpg" alt=""><br><img src="/img/20220906 110503 原神 torino/17.jpg" alt=""><br><img src="/img/20220906 110503 原神 torino/18.jpg" alt=""><br><img src="/img/20220906 110503 原神 torino/19.jpg" alt=""><br><img src="/img/20220906 110503 原神 torino/20.jpg" alt=""><br><img src="/img/20220906 110503 原神 torino/21.jpg" alt=""><br><img src="/img/20220906 110503 原神 torino/22.jpg" alt=""><br><img src="/img/20220906 110503 原神 torino/23.jpg" alt=""><br><img src="/img/20220906 110503 原神 torino/24.jpg" alt=""></p>          </div>]]></content>
    
    
    <summary type="html">原来你也玩原神</summary>
    
    
    
    <category term="插画" scheme="https://my.wjtblog.online/categories/%E6%8F%92%E7%94%BB/"/>
    
    
    <category term="二次元" scheme="https://my.wjtblog.online/tags/%E4%BA%8C%E6%AC%A1%E5%85%83/"/>
    
    <category term="原神" scheme="https://my.wjtblog.online/tags/%E5%8E%9F%E7%A5%9E/"/>
    
  </entry>
  
  <entry>
    <title>biya~</title>
    <link href="https://my.wjtblog.online/undefined/d87f7e0c.html"/>
    <id>https://my.wjtblog.online/undefined/d87f7e0c.html</id>
    <published>2022-09-05T13:41:00.000Z</published>
    <updated>2022-09-13T11:29:19.727Z</updated>
    
    <content type="html"><![CDATA[<div class="fj-gallery"><p><img src="/img/biya/0.jpg" alt="">s<br><img src="/img/biya/1.jpg" alt=""><br><img src="/img/biya/2.jpg" alt=""><br><img src="/img/biya/3.jpg" alt=""><br><img src="/img/biya/4.jpg" alt=""><br><img src="/img/biya/5.jpg" alt=""><br><img src="/img/biya/6.jpg" alt=""><br><img src="/img/biya/7.jpg" alt=""><br><img src="/img/biya/8.jpg" alt=""><br><img src="/img/biya/9.jpg" alt=""><br><img src="/img/biya/10.jpg" alt=""><br><img src="/img/biya/11.jpg" alt=""><br><img src="/img/biya/12.jpg" alt=""><br><img src="/img/biya/13.jpg" alt=""><br><img src="/img/biya/14.jpg" alt=""><br><img src="/img/biya/15.jpg" alt=""><br><img src="/img/biya/16.jpg" alt=""><br><img src="/img/biya/17.jpg" alt=""><br><img src="/img/biya/18.jpg" alt=""><br><img src="/img/biya/19.jpg" alt=""><br><img src="/img/biya/20.jpg" alt=""><br><img src="/img/biya/21.jpg" alt=""><br><img src="/img/biya/22.jpg" alt=""><br><img src="/img/biya/23.jpg" alt=""><br><img src="/img/biya/24.jpg" alt=""><br><img src="/img/biya/25.jpg" alt=""><br><img src="/img/biya/26.jpg" alt=""><br><img src="/img/biya/27.jpg" alt=""><br><img src="/img/biya/28.jpg" alt=""><br><img src="/img/biya/29.jpg" alt=""><br><img src="/img/biya/30.jpg" alt=""><br><img src="/img/biya/31.jpg" alt=""><br><img src="/img/biya/32.jpg" alt=""><br><img src="/img/biya/33.jpg" alt=""><br><img src="/img/biya/34.jpg" alt=""><br><img src="/img/biya/35.jpg" alt=""><br><img src="/img/biya/36.jpg" alt=""><br><img src="/img/biya/37.jpg" alt=""><br><img src="/img/biya/38.jpg" alt=""><br><img src="/img/biya/39.jpg" alt=""><br><img src="/img/biya/40.jpg" alt=""><br><img src="/img/biya/41.jpg" alt=""><br><img src="/img/biya/42.jpg" alt=""><br><img src="/img/biya/43.jpg" alt=""><br><img src="/img/biya/44.jpg" alt=""><br><img src="/img/biya/45.jpg" alt=""><br><img src="/img/biya/46.jpg" alt=""><br><img src="/img/biya/47.jpg" alt=""><br><img src="/img/biya/48.jpg" alt=""><br><img src="/img/biya/49.jpg" alt=""><br><img src="/img/biya/50.jpg" alt=""><br><img src="/img/biya/51.jpg" alt=""><br><img src="/img/biya/52.jpg" alt=""><br><img src="/img/biya/53.jpg" alt=""><br><img src="/img/biya/54.jpg" alt=""><br><img src="/img/biya/55.jpg" alt=""><br><img src="/img/biya/56.jpg" alt=""><br><img src="/img/biya/57.jpg" alt=""></p>          </div>]]></content>
    
    
    <summary type="html">biya小姐姐看了都说好</summary>
    
    
    
    <category term="插画" scheme="https://my.wjtblog.online/categories/%E6%8F%92%E7%94%BB/"/>
    
    
    <category term="biya" scheme="https://my.wjtblog.online/tags/biya/"/>
    
    <category term="二次元" scheme="https://my.wjtblog.online/tags/%E4%BA%8C%E6%AC%A1%E5%85%83/"/>
    
    <category term="美女" scheme="https://my.wjtblog.online/tags/%E7%BE%8E%E5%A5%B3/"/>
    
  </entry>
  
  <entry>
    <title>web抖音参数</title>
    <link href="https://my.wjtblog.online/undefined/fbf31d6e.html"/>
    <id>https://my.wjtblog.online/undefined/fbf31d6e.html</id>
    <published>2022-09-05T05:32:00.000Z</published>
    <updated>2022-09-06T05:12:16.431Z</updated>
    
    <content type="html"><![CDATA[<span class='p center logo large'>某短视频web端 X-Bogus及_signature参数</span><h2 id="题记"><a href="#题记" class="headerlink" title="题记"></a>题记</h2><span class='p left h4'>在文章开始前，先跟大伙介绍一下自己。本菜鸡今年刚毕业，现在在某厂做爬虫\逆向工程师，这个项目也是第一个接手的项目，前前后后看了一个多星期吧，把一些心得稍微记录一下，欢迎各位大佬指正嗷</span><h2 id="确定目标参数"><a href="#确定目标参数" class="headerlink" title="确定目标参数"></a>确定目标参数</h2><p>我们以搜索接口作为例子举例<br><div class="img-wrap"><div class="img-bg"><img class="img" src="/img/douyin/sousuojiekou.jpg"/></div></div><br>先搜索一下他数据在哪里<br>开发者工具 -&gt; network -&gt; 刷新 -&gt; Ctrl+f -&gt;搜索数据<br><div class="img-wrap"><div class="img-bg"><img class="img" src="/img/douyin/sousuoshuju.jpg"/></div></div><br>可以看到我们的（甜妹数据） 咳咳 搜索数据已经能找得到了那我们就去看看这个url长啥样<br>拉到postman上看一眼<br><div class="img-wrap"><div class="img-bg"><img class="img" src="/img/douyin/postman.jpg"/></div></div><br>被block了很正常，已经还有啥环境要补，我们先看参数<br>keyword : 关键字<br>msToken : 这个还不知道应该是生成的啥token<br>X-Bogus : 这个生成的字符串很可疑应该是加密的<br>我们把postman的环境参数补齐试试看能不能返回数据<br>PS. 有个小技巧postman有个Bulk Edit的按钮能直接帮我们格式化数据，我们复制粘贴即可，最后再点一下Key-Value Edit调整一下。<br><div class="img-wrap"><div class="img-bg"><img class="img" src="/img/douyin/postmanGet.jpg"/></div></div><br>可以看到咱们的数据已经出来了,之后把X-Bogus参数去掉试试<br>果然是没有掉了，那基本可以肯定这个是作为加密的一部分了<br>老样子去谷歌调试看看</p><h2 id="确定生成入口"><a href="#确定生成入口" class="headerlink" title="确定生成入口"></a>确定生成入口</h2><p>像类似于这种Get方法，加密参数在url里的我们可以直接使用谷歌浏览器的控制台之中的xhr提取断点<br><div class="img-wrap"><div class="img-bg"><img class="img" src="/img/douyin/xhr.jpg"/></div></div><br>我们先刷新网站,可以看到右侧作用域中的arguments已经有X-bougs参数了，然后就是看堆栈了<br><div class="img-wrap"><div class="img-bg"><img class="img" src="/img/douyin/webmssdk.jpg"/></div></div><br>可以看到这个应该是从webmssdk.js出来的，在开始和结束之前看看，会发现开始的时候还没有，结束了生成了，那这个js文件就是加密的入口<br><div class="tip key"><p>小知识补充</p></div><br>有些时候我们用xhr调试断点的时候会发现，如果项目结构太过复杂，在xhr断点生成时，我们仍然需要审阅很多代码，就不是很方便，有两种办法<br>注入hook 和 内存漫游<br>今天先介绍第一个</p><h3 id="注入hook"><a href="#注入hook" class="headerlink" title="注入hook"></a>注入hook</h3><p>话不多说先上代码<br><figure class="highlight js"><figcaption><span>first test</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 代码作者：掘金tager</span></span><br><span class="line"><span class="comment">// xhr中的方法拦截，eg: open、send etc.</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">hookFunction</span>(<span class="params">funcName, config</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> args = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">slice</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>)</span><br><span class="line">    <span class="comment">// 将open参数存入xhr, 在其它事件回调中可以获取到。</span></span><br><span class="line">    <span class="keyword">if</span> (funcName === <span class="string">&#x27;open&#x27;</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">xhr</span>.<span class="property">open_args</span> = args</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (config[funcName]) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>, <span class="string">&#x27;this&#x27;</span>)</span><br><span class="line">      <span class="comment">// 配置的函数执行结果返回为true时终止调用</span></span><br><span class="line">      <span class="keyword">var</span> result = config[funcName].<span class="title function_">call</span>(<span class="variable language_">this</span>, args, <span class="variable language_">this</span>.<span class="property">xhr</span>)</span><br><span class="line">      <span class="keyword">if</span> (result) <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">xhr</span>[funcName].<span class="title function_">apply</span>(<span class="variable language_">this</span>.<span class="property">xhr</span>, <span class="variable language_">arguments</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// xhr中的属性和事件的拦截</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getterFactory</span>(<span class="params">attr, config</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> value = <span class="variable language_">this</span>.<span class="title function_">hasOwnProperty</span>(attr + <span class="string">&quot;_&quot;</span>) ? <span class="variable language_">this</span>[attr + <span class="string">&quot;_&quot;</span>] : <span class="variable language_">this</span>.<span class="property">xhr</span>[attr];</span><br><span class="line">    <span class="keyword">var</span> getterHook = (config[attr] || &#123;&#125;)[<span class="string">&quot;getter&quot;</span>]</span><br><span class="line">    <span class="keyword">return</span> getterHook &amp;&amp; <span class="title function_">getterHook</span>(value, <span class="variable language_">this</span>) || value</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 在赋值时触发该工厂函数（如onload等事件）</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">setterFactory</span>(<span class="params">attr, config</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> _this = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">var</span> xhr = <span class="variable language_">this</span>.<span class="property">xhr</span>;</span><br><span class="line">    <span class="keyword">var</span> hook = config[attr]; <span class="comment">// 方法或对象</span></span><br><span class="line">    <span class="variable language_">this</span>[attr + <span class="string">&quot;_&quot;</span>] = value;</span><br><span class="line">    <span class="keyword">if</span> (<span class="regexp">/^on/</span>.<span class="title function_">test</span>(attr)) &#123;</span><br><span class="line">      <span class="comment">// note：间接的在真实的xhr上给事件绑定函数</span></span><br><span class="line">      xhr[attr] = <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">        <span class="comment">// e = configEvent(e, _this)</span></span><br><span class="line">        <span class="keyword">var</span> result = hook &amp;&amp; config[attr].<span class="title function_">call</span>(_this, xhr, e)</span><br><span class="line">        result || value.<span class="title function_">call</span>(_this, e);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">var</span> attrSetterHook = (hook || &#123;&#125;)[<span class="string">&quot;setter&quot;</span>]</span><br><span class="line">      value = attrSetterHook &amp;&amp; <span class="title function_">attrSetterHook</span>(value, _this) || value</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 并非xhr的所有属性都是可写的</span></span><br><span class="line">        xhr[attr] = value;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">warn</span>(<span class="string">&#x27;xhr的&#x27;</span> + attr + <span class="string">&#x27;属性不可写&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 核心拦截的handler</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">xhrHook</span>(<span class="params">config</span>) &#123;</span><br><span class="line">  <span class="comment">// 存储真实的xhr构造器, 在取消hook时，可恢复</span></span><br><span class="line">  <span class="variable language_">window</span>.<span class="property">realXhr</span> = <span class="variable language_">window</span>.<span class="property">realXhr</span> || <span class="title class_">XMLHttpRequest</span></span><br><span class="line">  <span class="comment">// 重写XMLHttpRequest构造函数</span></span><br><span class="line">  <span class="title class_">XMLHttpRequest</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> xhr = <span class="keyword">new</span> <span class="variable language_">window</span>.<span class="title function_">realXhr</span>()</span><br><span class="line">    <span class="comment">// 真实的xhr实例存储到自定义的xhr属性中</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">xhr</span> = xhr</span><br><span class="line">    <span class="comment">// note: 遍历实例及其原型上的属性（实例和原型链上有相同属性时，取实例属性）</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> attr <span class="keyword">in</span> xhr) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(xhr[attr]) === <span class="string">&#x27;[object Function]&#x27;</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>[attr] = <span class="title function_">hookFunction</span>(attr, config); <span class="comment">// 接管xhr function</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// attention: 如果重写XMLHttpRequest，必须要全部重写，否则在ajax中不会触发success、error（原因是3.x版本是在load事件中执行success）</span></span><br><span class="line">        <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(<span class="variable language_">this</span>, attr, &#123; <span class="comment">// 接管xhr attr、event</span></span><br><span class="line">          <span class="attr">get</span>: <span class="title function_">getterFactory</span>(attr, config),</span><br><span class="line">          <span class="attr">set</span>: <span class="title function_">setterFactory</span>(attr, config),</span><br><span class="line">          <span class="attr">enumerable</span>: <span class="literal">true</span></span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">window</span>.<span class="property">realXhr</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解除xhr拦截，归还xhr管理权</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">unXhrHook</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">window</span>[realXhr]) <span class="title class_">XMLHttpRequest</span> = <span class="variable language_">window</span>[realXhr];</span><br><span class="line">  <span class="variable language_">window</span>[realXhr] = <span class="literal">undefined</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 执行部分</span></span><br><span class="line"><span class="title function_">xhrHook</span>(&#123;</span><br><span class="line">  <span class="attr">open</span>: <span class="keyword">function</span> (<span class="params">args, xhr</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;open called!&quot;</span>, args, xhr)</span><br><span class="line">     <span class="comment">// return true // 返回true将终止请求，这个就是常规拦截的精髓了</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">setRequestHeader</span>: <span class="keyword">function</span> (<span class="params">args, xhr</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;setRequestHeader called!&quot;</span>, args, xhr)</span><br><span class="line">         &#125;,</span><br><span class="line">  <span class="attr">onload</span>: <span class="keyword">function</span> (<span class="params">xhr</span>) &#123;</span><br><span class="line">    <span class="comment">// 对响应结果做处理</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">responseText</span> += <span class="string">&#x27; tager&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><br>要理解这段代码需要一点js基础，对于初学者可以理解为当这个出现时就进行debugger操作,只是在操作的时候我们用另一个函数来监听参数的生成就可以了。<br>还有很多类似的hook，如Hook setInterval、Hook header、Hook Cookie Info等等<br>这边推荐去李玺老师的github上，有很多知识补充<br><div class="tag link"><a class="link-card" title="lx's github" href="https://github.com/lixi5338619"><div class="left"><img src="/img/siteicon/64.png"/></div><div class="right"><p class="text">lx's github</p><p class="url">https://github.com/lixi5338619</p></div></a></div></p><h2 id="确定加密方式，以及生成位置"><a href="#确定加密方式，以及生成位置" class="headerlink" title="确定加密方式，以及生成位置"></a>确定加密方式，以及生成位置</h2><p>我们先roll一眼代码 _0xxxxx 果然是混淆了一下，不过这个问题不大，后面看看用反混淆工具也能还原出来<br>没有看到具体的调用函数，而且还有各种±*/&gt;&gt;,&gt;&gt;&gt;,&lt;&lt;,|,&amp;,^,%在一起运算符，这种事典型的jsvmp的特征<br>关于jsvmp可以看这篇文章<br><div class="tag link"><a class="link-card" title="jsvmp" href="http://www.xjishu.com/zhuanli/55/201810446970.html"><div class="left"><img src="/img/siteicon/64.png"/></div><div class="right"><p class="text">jsvmp</p><p class="url">http://www.xjishu.com/zhuanli/55/201810446970.html</p></div></a></div><br>简单点来说就是jsvmp的函数都是匿名的，一般用call、apply的方法进行调用<br>那这个加密方式一般用打桩的方式进行log数据演示，这种方法可以看看十一姐的文章<br><div class="tag link"><a class="link-card" title="十一姐" href="https://blog.csdn.net/weixin_43411585/article/details/123672621"><div class="left"><img src="/img/siteicon/64.png"/></div><div class="right"><p class="text">十一姐</p><p class="url">https://blog.csdn.net/weixin_43411585/article/details/123672621</p></div></a></div><br>我们的目标是啥！<br>以最简单的方式获取数据！<br>（真的不是作者懒）<br>直接就是源码+入口函数+补环境一套操作<br>我们直接在webmssdk.js的堆栈前我们直接打断点<br>然后f9 f9 f9 f9 f9 f9 f9 f9 f9单步调试（对调试感兴趣的话可以在之后的文章中单独说）<br>然后就可以看到一个XMLHttprequest.send方法<br><div class="img-wrap"><div class="img-bg"><img class="img" src="/img/douyin/xmlsend.jpg"/></div></div><br>控制台log一下<br><div class="img-wrap"><div class="img-bg"><img class="img" src="/img/douyin/msTokenbefore.jpg"/></div></div><br>send方法后<br><div class="img-wrap"><div class="img-bg"><img class="img" src="/img/douyin/XBafter.jpg"/></div></div><br>那中间的参数就是在send方法中生成的了，之后的任务就是找到函数然后将参数和环境补齐即可<br>因为众所周知的原因不能说太多，不过到了这步之后耐心点也能出的来<br>X-Bogus及_signature都在这之中生成的</p><h2 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h2><p>补完环境后我们打包一下生成函数做成接口让python调用<br><div class="img-wrap"><div class="img-bg"><img class="img" src="/img/douyin/getXB.jpg"/></div></div><br>postman验证<br><div class="img-wrap"><div class="img-bg"><img class="img" src="/img/douyin/result.jpg"/></div></div><br>ok 已经解出来了<br>然后去尽情欣赏小姐姐的作品去吧<br><div class="img-wrap"><div class="img-bg"><img class="img" src="/img/douyin/2.jpg"/></div></div></p><h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><span class='p left h4'>第一次写文章，写得不好大家轻点喷。做逆向要耐心也看运气，所以暂时做不出来也不要着急，其实在逆向这个方向上最好还是别像我一样偷懒，切实逆向解出来才是真实的，对自己提升也大。利用打桩的方法我也弄了一些，后续有感兴趣的话可以再出一期。另外各位大佬有什么好的想法都可以跟我说，很欢迎大家一起讨论</span>]]></content>
    
    
    <summary type="html">外边小姐姐好看，里边更好看</summary>
    
    
    
    <category term="逆向" scheme="https://my.wjtblog.online/categories/%E9%80%86%E5%90%91/"/>
    
    
    <category term="技术" scheme="https://my.wjtblog.online/tags/%E6%8A%80%E6%9C%AF/"/>
    
  </entry>
  
</feed>
